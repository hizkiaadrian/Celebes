(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"x+MQ":function(e,t,a){"use strict";a.r(t),a.d(t,"ExpensesManagerModule",(function(){return Te}));var i=a("tyNb"),n=a("QdL7"),s=a("+0xr"),r=a("M9IT"),o=a("R0Ic"),c=a("3Pt+"),l=a("fXoL"),u=a("1q3R"),d=a("tk/3"),b=a("AytR"),p=a("2Vo4");let h=(()=>{class e{constructor(e,t){this.httpClient=e,this.authService=t,this.refreshSubject=new p.a(null),this.addExpense=e=>this.httpClient.post(b.a.backendUrl+"/expenses/add-expense",e,{headers:this.authService.addAuthorizedHeader()}),this.editExpense=(e,t)=>this.httpClient.patch(`${b.a.backendUrl}/expenses/edit-expense/${t}`,{expense:e},{headers:this.authService.addAuthorizedHeader()}),this.getAllExpenses=()=>this.httpClient.get(b.a.backendUrl+"/expenses/get-all-expenses",{headers:this.authService.addAuthorizedHeader()}),this.deleteExpense=e=>this.httpClient.delete(`${b.a.backendUrl}/expenses/delete-expense/${e}`,{headers:this.authService.addAuthorizedHeader()}),this.getDailyExpensesInDateRange=(e,t)=>this.httpClient.get(b.a.backendUrl+"/expenses/get-daily-expenses-in-range",{headers:this.authService.addAuthorizedHeader(),params:(new d.e).set("startDate",e.toUTCString()).set("endDate",t.toUTCString())}),this.findAllDistinctItems=(e,t)=>this.httpClient.get(b.a.backendUrl+"/expenses/find-all-distinct-items",{headers:this.authService.addAuthorizedHeader(),params:(new d.e).set("startDate",e.toUTCString()).set("endDate",t.toUTCString())}),this.getExpensesByItem=(e,t,a)=>this.httpClient.get(`${b.a.backendUrl}/expenses/get-expenses-by-item/${e}`,{headers:this.authService.addAuthorizedHeader(),params:(new d.e).set("startDate",t.toUTCString()).set("endDate",a.toUTCString())})}toggleRefresh(){this.refreshSubject.next(null)}}return e.\u0275fac=function(t){return new(t||e)(l.Wb(d.b),l.Wb(u.a))},e.\u0275prov=l.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var m=a("dNgK"),f=a("0IaG");let g=(()=>{class e{constructor(){this.onAmountChange=(e,t)=>{"amount"==t&&(e.value.pricePerUnit?e.patchValue({totalPrice:e.value.amount*e.value.pricePerUnit}):e.value.totalPrice&&e.patchValue({pricePerUnit:e.value.totalPrice/e.value.amount}))},this.onPricePerUnitChange=(e,t)=>{"pricePerUnit"===t&&e.patchValue({totalPrice:e.value.pricePerUnit*e.value.amount})},this.onTotalPriceChange=(e,t)=>{"totalPrice"===t&&e.value.amount&&e.patchValue({pricePerUnit:e.value.totalPrice/e.value.amount})}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=l.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var x=a("XiUz"),S=a("kmnG"),v=a("qFsG"),D=a("ofXK"),k=a("d3UM"),C=a("bTqV"),R=a("FKr1");function y(e,t){1&e&&(l.Sb(0,"mat-error"),l.Ac(1," Item is required "),l.Rb())}function A(e,t){1&e&&(l.Sb(0,"mat-error"),l.Ac(1," Supplier is required "),l.Rb())}function P(e,t){1&e&&(l.Sb(0,"mat-error"),l.Ac(1," Amount is required "),l.Rb())}function w(e,t){if(1&e&&(l.Sb(0,"mat-option",13),l.Ac(1),l.Rb()),2&e){const e=t.$implicit;l.kc("value",e),l.Bb(1),l.Cc(" ",e," ")}}function B(e,t){1&e&&(l.Sb(0,"mat-error"),l.Ac(1," Unit is required "),l.Rb())}function F(e,t){1&e&&(l.Sb(0,"mat-error"),l.Ac(1," Price per unit is required "),l.Rb())}function M(e,t){1&e&&(l.Sb(0,"mat-error"),l.Ac(1," Total price is required "),l.Rb())}let I=(()=>{class e{constructor(e,t,a,i,n,s){this.formBuilder=e,this.authService=t,this.expensesService=a,this.snackBar=i,this.dialogRef=n,this.priceCalculatorService=s,this.units=["kg","pcs","bottles"],this.onAmountChange=()=>this.priceCalculatorService.onAmountChange(this.expensesForm,this.lastChanged),this.onPricePerUnitChange=()=>this.priceCalculatorService.onPricePerUnitChange(this.expensesForm,this.lastChanged),this.onTotalPriceChange=()=>this.priceCalculatorService.onTotalPriceChange(this.expensesForm,this.lastChanged)}ngOnInit(){this.authService.userSubject.subscribe(e=>this.loggedInUser=e),this.expensesForm=this.formBuilder.group({item:[this.expense.item,[c.s.required]],supplier:[this.expense.supplier,[c.s.required]],amount:[this.expense.amount,[c.s.required]],unit:[this.expense.unit,[c.s.required]],pricePerUnit:[this.expense.pricePerUnit,[c.s.required]],totalPrice:[this.expense.totalPrice,[c.s.required]]})}changeLastChanged(e){this.lastChanged=e}submit(){this.expensesForm.valid&&this.expensesService.editExpense({item:this.expensesForm.value.item,supplier:this.expensesForm.value.supplier,amount:this.expensesForm.value.amount,unit:this.expensesForm.value.unit,pricePerUnit:this.expensesForm.value.pricePerUnit,totalPrice:this.expensesForm.value.totalPrice,dateOfExpense:this.expense.dateOfExpense,submittedBy:this.loggedInUser.name},this.expense._id).subscribe(e=>{this.snackBar.open(e.msg,"",{panelClass:[e.success?"success-snackbar":"error-snackbar"]}),this.expensesService.toggleRefresh(),this.dialogRef.close()},()=>{this.snackBar.open("Something wrong has happened","",{panelClass:["error-snackbar"]})})}}return e.\u0275fac=function(t){return new(t||e)(l.Mb(c.d),l.Mb(u.a),l.Mb(h),l.Mb(m.b),l.Mb(f.c),l.Mb(g))},e.\u0275cmp=l.Gb({type:e,selectors:[["app-edit-expense-form"]],inputs:{expense:"expense",_id:"_id"},decls:38,vars:8,consts:[["fxFill","","fxLayoutAlign","center center"],["fxLayout","column","fxFlex","100%","fxFlex.gt-md","70%","autocomplete","off",3,"formGroup","ngSubmit"],["appearance","standard"],["matInput","","formControlName","item","type","text"],[4,"ngIf"],["matInput","","formControlName","supplier","type","text"],["matInput","","formControlName","amount","type","number",3,"focus","ngModelChange"],["formControlName","unit"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","pricePerUnit","type","number",3,"focus","ngModelChange"],["matInput","","formControlName","totalPrice","type","number",3,"focus","ngModelChange"],["fxLayoutAlign","center"],["mat-raised-button","","color","primary","type","submit"],[3,"value"]],template:function(e,t){1&e&&(l.Sb(0,"div",0),l.Sb(1,"form",1),l.ac("ngSubmit",(function(){return t.submit()})),l.Sb(2,"h2"),l.Ac(3,"Edit expense"),l.Rb(),l.Sb(4,"mat-form-field",2),l.Sb(5,"mat-label"),l.Ac(6,"Item"),l.Rb(),l.Nb(7,"input",3),l.zc(8,y,2,0,"mat-error",4),l.Rb(),l.Sb(9,"mat-form-field",2),l.Sb(10,"mat-label"),l.Ac(11,"Supplier"),l.Rb(),l.Nb(12,"input",5),l.zc(13,A,2,0,"mat-error",4),l.Rb(),l.Sb(14,"mat-form-field",2),l.Sb(15,"mat-label"),l.Ac(16,"Amount"),l.Rb(),l.Sb(17,"input",6),l.ac("focus",(function(){return t.changeLastChanged("amount")}))("ngModelChange",(function(){return t.onAmountChange()})),l.Rb(),l.zc(18,P,2,0,"mat-error",4),l.Rb(),l.Sb(19,"mat-form-field",2),l.Sb(20,"mat-label"),l.Ac(21,"Unit"),l.Rb(),l.Sb(22,"mat-select",7),l.zc(23,w,2,2,"mat-option",8),l.Rb(),l.zc(24,B,2,0,"mat-error",4),l.Rb(),l.Sb(25,"mat-form-field",2),l.Sb(26,"mat-label"),l.Ac(27,"Price per unit"),l.Rb(),l.Sb(28,"input",9),l.ac("focus",(function(){return t.changeLastChanged("pricePerUnit")}))("ngModelChange",(function(){return t.onPricePerUnitChange()})),l.Rb(),l.zc(29,F,2,0,"mat-error",4),l.Rb(),l.Sb(30,"mat-form-field",2),l.Sb(31,"mat-label"),l.Ac(32,"Total price"),l.Rb(),l.Sb(33,"input",10),l.ac("focus",(function(){return t.changeLastChanged("totalPrice")}))("ngModelChange",(function(){return t.onTotalPriceChange()})),l.Rb(),l.zc(34,M,2,0,"mat-error",4),l.Rb(),l.Sb(35,"div",11),l.Sb(36,"button",12),l.Ac(37,"Submit"),l.Rb(),l.Rb(),l.Rb(),l.Rb()),2&e&&(l.Bb(1),l.kc("formGroup",t.expensesForm),l.Bb(7),l.kc("ngIf",t.expensesForm.get("item").hasError("required")),l.Bb(5),l.kc("ngIf",t.expensesForm.get("supplier").hasError("required")),l.Bb(5),l.kc("ngIf",t.expensesForm.get("amount").hasError("required")),l.Bb(5),l.kc("ngForOf",t.units),l.Bb(1),l.kc("ngIf",t.expensesForm.get("unit").hasError("required")),l.Bb(5),l.kc("ngIf",t.expensesForm.get("pricePerUnit").hasError("required")),l.Bb(5),l.kc("ngIf",t.expensesForm.get("totalPrice").hasError("required")))},directives:[x.e,x.b,c.t,c.n,x.c,x.a,c.h,S.c,S.f,v.b,c.c,c.m,c.g,D.m,c.q,k.a,D.l,C.b,S.b,R.o],styles:[""]}),e})(),E=(()=>{class e{constructor(e,t,a){this.dialogRef=e,this.expensesService=t,this.snackBar=a}ngOnInit(){}goBack(){this.dialogRef.close()}confirmDelete(){this.expensesService.deleteExpense(this._id).subscribe(e=>{e.success?(this.snackBar.open("Expense deleted successfully","",{panelClass:["success-snackbar"]}),this.expensesService.toggleRefresh(),this.dialogRef.close()):this.snackBar.open(e.msg,"",{panelClass:["error-snackbar"]})})}}return e.\u0275fac=function(t){return new(t||e)(l.Mb(f.c),l.Mb(h),l.Mb(m.b))},e.\u0275cmp=l.Gb({type:e,selectors:[["app-delete-expense-form"]],inputs:{_id:"_id"},decls:10,vars:0,consts:[[2,"color","red"],["fxLayout","row","fxLayoutGap","4px","fxLayoutAlign","end end"],["mat-stroked-button","","color","primary",3,"click"],["mat-raised-button","","color","warn",3,"click"]],template:function(e,t){1&e&&(l.Sb(0,"div"),l.Sb(1,"h2"),l.Ac(2,"Delete this entry?"),l.Rb(),l.Sb(3,"div",0),l.Ac(4,"This action cannot be undone"),l.Rb(),l.Sb(5,"div",1),l.Sb(6,"button",2),l.ac("click",(function(){return t.goBack()})),l.Ac(7,"Back"),l.Rb(),l.Sb(8,"button",3),l.ac("click",(function(){return t.confirmDelete()})),l.Ac(9,"Delete"),l.Rb(),l.Rb(),l.Rb())},directives:[x.c,x.d,x.b,C.b],styles:[""]}),e})();var L=a("2pJz");let T=(()=>{class e{constructor(){this.ticksInADay=864e5,this.now=()=>new Date,this.today=()=>this.removeTime(new Date),this.addDays=(e,t)=>new Date(e.getTime()+t*this.ticksInADay),this.removeTime=e=>new Date(e.setHours(0,0,0))}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=l.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var U=a("qUOr"),z=a("NFeN"),O=a("Qu3c");let q=(()=>{class e{transform(e,...t){return"Rp "+new D.f("en-US").transform(e,"")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=l.Lb({name:"rupiah",type:e,pure:!0}),e})();function N(e,t){1&e&&(l.Sb(0,"th",20),l.Ac(1," Date"),l.Rb())}function j(e,t){if(1&e&&(l.Sb(0,"td",21),l.Ac(1),l.fc(2,"date"),l.Rb()),2&e){const e=t.$implicit;l.Bb(1),l.Bc(l.hc(2,1,e.dateOfExpense,"d MMMM yyyy, HH:mm"))}}function G(e,t){1&e&&(l.Sb(0,"th",20),l.Ac(1," Item"),l.Rb())}function _(e,t){if(1&e&&(l.Sb(0,"td",21),l.Ac(1),l.Rb()),2&e){const e=t.$implicit;l.Bb(1),l.Bc(e.item)}}function W(e,t){1&e&&(l.Sb(0,"th",20),l.Ac(1," Supplier"),l.Rb())}function $(e,t){if(1&e&&(l.Sb(0,"td",21),l.Ac(1),l.Rb()),2&e){const e=t.$implicit;l.Bb(1),l.Bc(e.supplier)}}function H(e,t){1&e&&(l.Sb(0,"th",20),l.Ac(1," Amount"),l.Rb())}function Q(e,t){if(1&e&&(l.Sb(0,"td",21),l.Ac(1),l.Rb()),2&e){const e=t.$implicit;l.Bb(1),l.Dc("",e.amount," ",e.unit,"")}}function V(e,t){1&e&&(l.Sb(0,"th",20),l.Ac(1," Price/Unit"),l.Rb())}function J(e,t){if(1&e&&(l.Sb(0,"td",21),l.Ac(1),l.fc(2,"rupiah"),l.Rb()),2&e){const e=t.$implicit;l.Bb(1),l.Bc(l.gc(2,1,e.pricePerUnit))}}function K(e,t){1&e&&(l.Sb(0,"th",20),l.Ac(1," Total Price"),l.Rb())}function X(e,t){if(1&e&&(l.Sb(0,"td",21),l.Ac(1),l.fc(2,"rupiah"),l.Rb()),2&e){const e=t.$implicit;l.Bb(1),l.Bc(l.gc(2,1,e.totalPrice))}}function Z(e,t){1&e&&(l.Sb(0,"th",20),l.Ac(1," Submitted by"),l.Rb())}function Y(e,t){if(1&e&&(l.Sb(0,"td",21),l.Ac(1),l.Rb()),2&e){const e=t.$implicit;l.Bb(1),l.Bc(e.submittedBy)}}function ee(e,t){if(1&e){const e=l.Tb();l.Sb(0,"td",21),l.Sb(1,"div",22),l.Sb(2,"div",23),l.Sb(3,"div",24),l.Ac(4),l.Rb(),l.Sb(5,"div"),l.Ac(6),l.Rb(),l.Rb(),l.Sb(7,"div",25),l.Sb(8,"button",26),l.ac("click",(function(){l.rc(e);const a=t.$implicit;return l.ec(2).openEditExpenseFormDialog(a)})),l.Sb(9,"mat-icon"),l.Ac(10,"edit"),l.Rb(),l.Rb(),l.Sb(11,"div",27),l.Sb(12,"button",28),l.ac("click",(function(){l.rc(e);const a=t.$implicit;return l.ec(2).openDeleteExpenseFormDialog(a._id)})),l.Sb(13,"mat-icon"),l.Ac(14,"delete"),l.Rb(),l.Rb(),l.Rb(),l.Rb(),l.Rb(),l.Rb()}if(2&e){const e=t.$implicit,a=l.ec(2);l.Cb("colspan",a.displayedColumns.length),l.Bb(1),l.kc("@detailExpand",e==a.expandedRow?"expanded":"collapsed"),l.Bb(3),l.Cc("Expense ID: ",e._id,""),l.Bb(2),l.Cc("Invoice ID: ",null==e.invoice_id?"No invoice ID":e.invoice_id,""),l.Bb(5),l.kc("matTooltipDisabled",a.isAuthorizedToDelete)("matTooltipPosition","below"),l.Bb(1),l.kc("disabled",!a.isAuthorizedToDelete)}}function te(e,t){1&e&&l.Nb(0,"tr",29)}function ae(e,t){if(1&e){const e=l.Tb();l.Sb(0,"tr",30),l.ac("click",(function(){l.rc(e);const a=t.$implicit,i=l.ec(2);return i.expandedRow=i.expandedRow===a?null:a})),l.Rb()}}function ie(e,t){1&e&&l.Nb(0,"tr",31)}function ne(e,t){if(1&e&&(l.Sb(0,"tr",32),l.Sb(1,"td",33),l.Ac(2,"No data"),l.Rb(),l.Rb()),2&e){const e=l.ec(2);l.Bb(1),l.kc("colSpan",e.displayedColumns.length)}}const se=function(){return["expandedDetail"]};function re(e,t){if(1&e&&(l.Sb(0,"table",5),l.Qb(1,6),l.zc(2,N,2,0,"th",7),l.zc(3,j,3,4,"td",8),l.Pb(),l.Qb(4,9),l.zc(5,G,2,0,"th",7),l.zc(6,_,2,1,"td",8),l.Pb(),l.Qb(7,10),l.zc(8,W,2,0,"th",7),l.zc(9,$,2,1,"td",8),l.Pb(),l.Qb(10,11),l.zc(11,H,2,0,"th",7),l.zc(12,Q,2,2,"td",8),l.Pb(),l.Qb(13,12),l.zc(14,V,2,0,"th",7),l.zc(15,J,3,3,"td",8),l.Pb(),l.Qb(16,13),l.zc(17,K,2,0,"th",7),l.zc(18,X,3,3,"td",8),l.Pb(),l.Qb(19,14),l.zc(20,Z,2,0,"th",7),l.zc(21,Y,2,1,"td",8),l.Pb(),l.Qb(22,15),l.zc(23,ee,15,7,"td",8),l.Pb(),l.zc(24,te,1,0,"tr",16),l.zc(25,ae,1,0,"tr",17),l.zc(26,ie,1,0,"tr",18),l.zc(27,ne,3,1,"tr",19),l.Rb()),2&e){const e=l.ec();l.kc("dataSource",e.dataSource),l.Bb(24),l.kc("matHeaderRowDef",e.displayedColumns),l.Bb(1),l.kc("matRowDefColumns",e.displayedColumns),l.Bb(1),l.kc("matRowDefColumns",l.lc(4,se))}}const oe=function(){return[5,10]};let ce=(()=>{class e{constructor(e,t,a,i){this.expensesService=e,this.authService=t,this.dialog=a,this.dateService=i,this.displayedColumns=["date","item","supplier","amount","pricePerUnit","totalPrice","submittedBy"],this.populateDataSourceWithExpenses=()=>{this.expensesService.getAllExpenses().subscribe(e=>{this.dataSource=new s.l(e.expenses),this.dataSource.paginator=this.paginator,this.lastUpdated=this.dateService.now()})}}ngOnInit(){this.populateDataSourceWithExpenses(),this.authService.userSubject.subscribe(e=>{e&&(this.isAuthorizedToDelete=this.authService.getUserRole()!==L.a.Employee)}),this.expensesService.refreshSubject.subscribe(()=>this.populateDataSourceWithExpenses())}openEditExpenseFormDialog(e){let t=this.dialog.open(I,{width:"500px"});t.componentInstance.expense=e,t.afterClosed().subscribe(this.populateDataSourceWithExpenses)}openDeleteExpenseFormDialog(e){let t=this.dialog.open(E,{width:"500px"});t.componentInstance._id=e,t.afterClosed().subscribe(this.populateDataSourceWithExpenses)}}return e.\u0275fac=function(t){return new(t||e)(l.Mb(h),l.Mb(u.a),l.Mb(f.a),l.Mb(T))},e.\u0275cmp=l.Gb({type:e,selectors:[["app-list-of-expenses"]],viewQuery:function(e,t){var a;1&e&&l.vc(r.a,!0),2&e&&l.oc(a=l.bc())&&(t.paginator=a.first)},decls:7,vars:8,consts:[["fxFlex","","fxLayout","column"],["mat-table","","multiTemplateDataRows","",3,"dataSource",4,"appLoading"],["fxLayout","row","fxLayoutAlign","space-between center"],[1,"mat-h3"],[3,"pageSizeOptions","pageSize"],["mat-table","","multiTemplateDataRows","",3,"dataSource"],["matColumnDef","date"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","item"],["matColumnDef","supplier"],["matColumnDef","amount"],["matColumnDef","pricePerUnit"],["matColumnDef","totalPrice"],["matColumnDef","submittedBy"],["matColumnDef","expandedDetail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","clickable",3,"click",4,"matRowDef","matRowDefColumns"],["mat-row","","class","hidden-row",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["mat-header-cell",""],["mat-cell",""],["fxLayout","row","fxLayoutAlign","space-evenly center",1,"expanded-row"],[1,"expanded-detail"],[2,"margin-bottom","5px"],["fxLayout","row"],["mat-mini-fab","","color","primary","aria-label","Edit",2,"margin-right","4px",3,"click"],["matTooltip","Must be a manager or above to delete",3,"matTooltipDisabled","matTooltipPosition"],["mat-mini-fab","","color","warn","aria-label","Delete",3,"disabled","click"],["mat-header-row",""],["mat-row","",1,"clickable",3,"click"],["mat-row","",1,"hidden-row"],[1,"mat-row"],[1,"mat-cell",3,"colSpan"]],template:function(e,t){1&e&&(l.Sb(0,"div",0),l.zc(1,re,28,5,"table",1),l.Sb(2,"div",2),l.Sb(3,"h5",3),l.Ac(4),l.fc(5,"date"),l.Rb(),l.Nb(6,"mat-paginator",4),l.Rb(),l.Rb()),2&e&&(l.Bb(1),l.kc("appLoading",void 0===t.dataSource||0===t.dataSource.data.length),l.Bb(3),l.Cc("Last updated: ",l.hc(5,4,t.lastUpdated,"short"),""),l.Bb(2),l.kc("pageSizeOptions",l.lc(7,oe))("pageSize",10))},directives:[x.a,x.c,U.a,x.b,r.a,s.k,s.c,s.e,s.b,s.g,s.j,s.h,s.d,s.a,C.b,z.a,O.a,s.f,s.i],pipes:[D.e,q],styles:["table[_ngcontent-%COMP%]{width:100%}.mat-form-field[_ngcontent-%COMP%]{font-size:14px;width:100%}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{width:auto}.mat-cell[_ngcontent-%COMP%]{text-align:left}.clickable[_ngcontent-%COMP%]{cursor:pointer}.hidden-row[_ngcontent-%COMP%]{height:0}.expanded-row[_ngcontent-%COMP%]{overflow:hidden}.expanded-detail[_ngcontent-%COMP%]{padding:10px 0;margin:50px 0}"],data:{animation:[Object(o.n)("detailExpand",[Object(o.k)("collapsed",Object(o.l)({height:"0px",minHeight:"0"})),Object(o.k)("expanded",Object(o.l)({height:"*"})),Object(o.m)("expanded <=> collapsed",Object(o.e)("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}}),e})();function le(e,t){1&e&&(l.Sb(0,"mat-error"),l.Ac(1," Item is required "),l.Rb())}function ue(e,t){1&e&&(l.Sb(0,"mat-error"),l.Ac(1," Supplier is required "),l.Rb())}function de(e,t){1&e&&(l.Sb(0,"mat-error"),l.Ac(1," Amount is required "),l.Rb())}function be(e,t){if(1&e&&(l.Sb(0,"mat-option",13),l.Ac(1),l.Rb()),2&e){const e=t.$implicit;l.kc("value",e),l.Bb(1),l.Cc(" ",e," ")}}function pe(e,t){1&e&&(l.Sb(0,"mat-error"),l.Ac(1," Unit is required "),l.Rb())}function he(e,t){1&e&&(l.Sb(0,"mat-error"),l.Ac(1," Price per unit is required "),l.Rb())}function me(e,t){1&e&&(l.Sb(0,"mat-error"),l.Ac(1," Total price is required "),l.Rb())}let fe=(()=>{class e{constructor(e,t,a,i,n,s){this.formBuilder=e,this.authService=t,this.expensesService=a,this.snackBar=i,this.dialogRef=n,this.priceCalculatorService=s,this.units=["kg","pcs","bottles"],this.expensesForm=this.formBuilder.group({item:[void 0,[c.s.required]],supplier:[void 0,[c.s.required]],amount:[void 0,[c.s.required]],unit:[this.units[0],[c.s.required]],pricePerUnit:[void 0,[c.s.required]],totalPrice:[void 0,[c.s.required]]}),this.onAmountChange=()=>this.priceCalculatorService.onAmountChange(this.expensesForm,this.lastChanged),this.onPricePerUnitChange=()=>this.priceCalculatorService.onPricePerUnitChange(this.expensesForm,this.lastChanged),this.onTotalPriceChange=()=>this.priceCalculatorService.onTotalPriceChange(this.expensesForm,this.lastChanged)}ngOnInit(){this.authService.userSubject.subscribe(e=>this.loggedInUser=e)}changeLastChanged(e){this.lastChanged=e}submit(){if(this.expensesForm.valid){let e={item:this.expensesForm.value.item,supplier:this.expensesForm.value.supplier,amount:this.expensesForm.value.amount,unit:this.expensesForm.value.unit,pricePerUnit:this.expensesForm.value.pricePerUnit,totalPrice:this.expensesForm.value.totalPrice,dateOfExpense:new Date,submittedBy:this.loggedInUser.name};this.expensesService.addExpense(e).subscribe(e=>{this.snackBar.open(e.msg,"",{panelClass:[e.success?"success-snackbar":"error-snackbar"]}),this.expensesService.toggleRefresh(),this.dialogRef.close()})}}}return e.\u0275fac=function(t){return new(t||e)(l.Mb(c.d),l.Mb(u.a),l.Mb(h),l.Mb(m.b),l.Mb(f.c),l.Mb(g))},e.\u0275cmp=l.Gb({type:e,selectors:[["app-add-expense-form"]],decls:38,vars:8,consts:[["fxFill","","fxLayoutAlign","center center"],["fxLayout","column","fxFlex","100%","fxFlex.gt-md","70%","autocomplete","off",3,"formGroup","ngSubmit"],["appearance","standard"],["matInput","","formControlName","item","type","text"],[4,"ngIf"],["matInput","","formControlName","supplier","type","text"],["matInput","","formControlName","amount","type","number",3,"focus","ngModelChange"],["formControlName","unit"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","pricePerUnit","type","number",3,"focus","ngModelChange"],["matInput","","formControlName","totalPrice","type","number",3,"focus","ngModelChange"],["fxLayoutAlign","center"],["mat-raised-button","","color","primary","type","submit"],[3,"value"]],template:function(e,t){1&e&&(l.Sb(0,"div",0),l.Sb(1,"form",1),l.ac("ngSubmit",(function(){return t.submit()})),l.Sb(2,"h2"),l.Ac(3,"Add a new expense"),l.Rb(),l.Sb(4,"mat-form-field",2),l.Sb(5,"mat-label"),l.Ac(6,"Item"),l.Rb(),l.Nb(7,"input",3),l.zc(8,le,2,0,"mat-error",4),l.Rb(),l.Sb(9,"mat-form-field",2),l.Sb(10,"mat-label"),l.Ac(11,"Supplier"),l.Rb(),l.Nb(12,"input",5),l.zc(13,ue,2,0,"mat-error",4),l.Rb(),l.Sb(14,"mat-form-field",2),l.Sb(15,"mat-label"),l.Ac(16,"Amount"),l.Rb(),l.Sb(17,"input",6),l.ac("focus",(function(){return t.changeLastChanged("amount")}))("ngModelChange",(function(){return t.onAmountChange()})),l.Rb(),l.zc(18,de,2,0,"mat-error",4),l.Rb(),l.Sb(19,"mat-form-field",2),l.Sb(20,"mat-label"),l.Ac(21,"Unit"),l.Rb(),l.Sb(22,"mat-select",7),l.zc(23,be,2,2,"mat-option",8),l.Rb(),l.zc(24,pe,2,0,"mat-error",4),l.Rb(),l.Sb(25,"mat-form-field",2),l.Sb(26,"mat-label"),l.Ac(27,"Price per unit"),l.Rb(),l.Sb(28,"input",9),l.ac("focus",(function(){return t.changeLastChanged("pricePerUnit")}))("ngModelChange",(function(){return t.onPricePerUnitChange()})),l.Rb(),l.zc(29,he,2,0,"mat-error",4),l.Rb(),l.Sb(30,"mat-form-field",2),l.Sb(31,"mat-label"),l.Ac(32,"Total price"),l.Rb(),l.Sb(33,"input",10),l.ac("focus",(function(){return t.changeLastChanged("totalPrice")}))("ngModelChange",(function(){return t.onTotalPriceChange()})),l.Rb(),l.zc(34,me,2,0,"mat-error",4),l.Rb(),l.Sb(35,"div",11),l.Sb(36,"button",12),l.Ac(37,"Submit"),l.Rb(),l.Rb(),l.Rb(),l.Rb()),2&e&&(l.Bb(1),l.kc("formGroup",t.expensesForm),l.Bb(7),l.kc("ngIf",t.expensesForm.get("item").hasError("required")),l.Bb(5),l.kc("ngIf",t.expensesForm.get("supplier").hasError("required")),l.Bb(5),l.kc("ngIf",t.expensesForm.get("amount").hasError("required")),l.Bb(5),l.kc("ngForOf",t.units),l.Bb(1),l.kc("ngIf",t.expensesForm.get("unit").hasError("required")),l.Bb(5),l.kc("ngIf",t.expensesForm.get("pricePerUnit").hasError("required")),l.Bb(5),l.kc("ngIf",t.expensesForm.get("totalPrice").hasError("required")))},directives:[x.e,x.b,c.t,c.n,x.c,x.a,c.h,S.c,S.f,v.b,c.c,c.m,c.g,D.m,c.q,k.a,D.l,C.b,S.b,R.o],styles:[""]}),e})();var ge=a("wZkO");let xe=(()=>{class e{constructor(e,t){this.dialog=e,this.router=t,this.dashboardTitle="Expenses Manager"}openAddExpenseFormDialog(){this.dialog.open(fe,{width:"500px"})}}return e.\u0275fac=function(t){return new(t||e)(l.Mb(f.a),l.Mb(i.b))},e.\u0275cmp=l.Gb({type:e,selectors:[["app-dashboard"]],decls:13,vars:5,consts:[["mat-button","","color","primary",3,"click"],["aria-label","Add",2,"margin-right","5px"],[1,"mat-h3",2,"display","inline"],["mat-tab-nav-bar",""],["mat-tab-link","",3,"routerLink","active"]],template:function(e,t){1&e&&(l.Sb(0,"h1"),l.Ac(1),l.Rb(),l.Sb(2,"button",0),l.ac("click",(function(){return t.openAddExpenseFormDialog()})),l.Sb(3,"mat-icon",1),l.Ac(4,"library_add"),l.Rb(),l.Sb(5,"div",2),l.Ac(6,"Add a new expense"),l.Rb(),l.Rb(),l.Sb(7,"nav",3),l.Sb(8,"a",4),l.Ac(9,"List of Expenses"),l.Rb(),l.Sb(10,"a",4),l.Ac(11,"Charts"),l.Rb(),l.Rb(),l.Nb(12,"router-outlet")),2&e&&(l.Bb(1),l.Bc(t.dashboardTitle),l.Bb(7),l.kc("routerLink","list-of-expenses")("active",t.router.url.endsWith("list-of-expenses")),l.Bb(2),l.kc("routerLink","charts")("active",t.router.url.endsWith("charts")))},directives:[C.b,z.a,ge.b,i.c,ge.a,i.e],styles:[""]}),e})();var Se=function(e){return e[e.ThisWeek=0]="ThisWeek",e[e.ThisMonth=1]="ThisMonth",e[e.Custom=2]="Custom",e}({}),ve=a("QibW"),De=a("iadO");let ke=(()=>{class e{constructor(e,t){this.formBuilder=e,this.dateService=t,this.startDateEmitter=new l.o,this.endDateEmitter=new l.o,this.today=this.dateService.today(),this.lastWeek=this.dateService.addDays(this.today,-7),this.lastMonth=this.dateService.addDays(this.today,-30),this.datePickerForm=this.formBuilder.group({mode:[Se.ThisWeek],startDate:[{value:this.lastWeek,disabled:!0}],endDate:[{value:this.today,disabled:!0}]}),this.emitStartDateInput=()=>{this.startDateEmitter.emit(this.datePickerForm.get("startDate").value)},this.emitEndDateInput=()=>{this.endDateEmitter.emit(this.datePickerForm.get("endDate").value)}}get datepickerMode(){return Se}ngOnInit(){this.emitStartDateInput(),this.emitEndDateInput()}updateDateRangeAndToggleFormDisable(){switch(this.datePickerForm.get("mode").value){case Se.ThisWeek:this.datePickerForm.patchValue({startDate:this.lastWeek,endDate:this.today}),this.datePickerForm.controls.startDate.disable(),this.datePickerForm.controls.endDate.disable();break;case Se.ThisMonth:this.datePickerForm.patchValue({startDate:this.lastMonth,endDate:this.today}),this.datePickerForm.controls.startDate.disable(),this.datePickerForm.controls.endDate.disable();break;case Se.Custom:this.datePickerForm.controls.startDate.enable(),this.datePickerForm.controls.endDate.enable()}}}return e.\u0275fac=function(t){return new(t||e)(l.Mb(c.d),l.Mb(T))},e.\u0275cmp=l.Gb({type:e,selectors:[["app-datepicker"]],outputs:{startDateEmitter:"startDateEmitter",endDateEmitter:"endDateEmitter"},decls:24,vars:9,consts:[["fxLayout","column"],[3,"formGroup"],["formControlName","mode","aria-label","Select an option","fxLayout","row","fxLayoutGap","10px",2,"margin-left","5px",3,"ngModelChange"],[3,"checked","value"],[3,"value"],["fxLayout","row","fxLayoutAlign","space-evenly"],["appearance","standard"],["matInput","","formControlName","startDate",3,"matDatepicker","ngModelChange"],["matSuffix","",3,"for"],["startDatePicker",""],["matInput","","formControlName","endDate",3,"matDatepicker","ngModelChange"],["endDatePicker",""]],template:function(e,t){if(1&e&&(l.Sb(0,"div",0),l.Sb(1,"form",1),l.Sb(2,"mat-radio-group",2),l.ac("ngModelChange",(function(){return t.updateDateRangeAndToggleFormDisable()})),l.Sb(3,"mat-radio-button",3),l.Ac(4,"This week "),l.Rb(),l.Sb(5,"mat-radio-button",4),l.Ac(6,"This month"),l.Rb(),l.Sb(7,"mat-radio-button",4),l.Ac(8,"Custom"),l.Rb(),l.Rb(),l.Sb(9,"div",5),l.Sb(10,"mat-form-field",6),l.Sb(11,"mat-label"),l.Ac(12,"Start date"),l.Rb(),l.Sb(13,"input",7),l.ac("ngModelChange",(function(){return t.emitStartDateInput()})),l.Rb(),l.Nb(14,"mat-datepicker-toggle",8),l.Nb(15,"mat-datepicker",null,9),l.Rb(),l.Sb(17,"mat-form-field",6),l.Sb(18,"mat-label"),l.Ac(19,"End date"),l.Rb(),l.Sb(20,"input",10),l.ac("ngModelChange",(function(){return t.emitEndDateInput()})),l.Rb(),l.Nb(21,"mat-datepicker-toggle",8),l.Nb(22,"mat-datepicker",null,11),l.Rb(),l.Rb(),l.Rb(),l.Rb()),2&e){const e=l.pc(16),a=l.pc(23);l.Bb(1),l.kc("formGroup",t.datePickerForm),l.Bb(2),l.kc("checked",t.datePickerForm.get("mode").value===t.datepickerMode.ThisWeek)("value",t.datepickerMode.ThisWeek),l.Bb(2),l.kc("value",t.datepickerMode.ThisMonth),l.Bb(2),l.kc("value",t.datepickerMode.Custom),l.Bb(6),l.kc("matDatepicker",e),l.Bb(1),l.kc("for",e),l.Bb(6),l.kc("matDatepicker",a),l.Bb(1),l.kc("for",a)}},directives:[x.c,c.t,c.n,c.h,ve.b,c.m,c.g,x.d,ve.a,x.b,S.c,S.f,v.b,c.c,De.b,De.d,S.g,De.a],styles:[""]}),e})();var Ce=a("LPYB");const Re=function(){return{borderColor:"black",backgroundColor:"rgba(0,0,0,0)"}},ye=function(e){return[e]};function Ae(e,t){if(1&e&&l.Nb(0,"canvas",5),2&e){const e=l.ec(2);l.kc("datasets",e.chartData)("labels",e.chartLabels)("options",e.chartOptions)("colors",l.mc(6,ye,l.lc(5,Re)))("legend",!1)}}function Pe(e,t){if(1&e&&(l.Sb(0,"div",3),l.zc(1,Ae,1,8,"canvas",4),l.Rb()),2&e){const e=l.ec();l.Bb(1),l.kc("ngIf",e.chartData)}}let we=(()=>{class e{constructor(e,t,a){this.expensesService=e,this.dateService=t,this.snackBar=a,this.expensesData=[],this.chartOptions={responsive:!0,scales:{xAxes:[{scaleLabel:{labelString:"Date",display:!0},ticks:{maxTicksLimit:10}}],yAxes:[{scaleLabel:{labelString:"Amount spent",display:!0},ticks:{maxTicksLimit:10,callback:function(e){return(new q).transform(e).toString()}}}]}},this.isLoading=!1,this.listenToStartDate=e=>{this.startDate=e,void 0!==this.endDate&&this.updateChartData()},this.listenToEndDate=e=>{this.endDate=e,void 0!==this.startDate&&this.updateChartData()},this.updateChartData=()=>{this.isLoading||(this.isLoading=!0,this.expensesService.getDailyExpensesInDateRange(this.startDate,this.endDate).subscribe(e=>{e.success?(this.expensesData=e.expenses.sort((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime()),this.chartData=[{data:this.expensesData.map(e=>e.expense)}],this.chartLabels=this.expensesData.map(e=>new Date(e.date).toLocaleDateString("en-GB"))):this.snackBar.open(e.msg,"",{panelClass:["error-snackbar"]}),this.isLoading=!1}))},this.startDate=this.dateService.addDays(this.dateService.today(),-7),this.endDate=this.dateService.today()}ngOnInit(){this.expensesService.refreshSubject.subscribe(this.updateChartData)}}return e.\u0275fac=function(t){return new(t||e)(l.Mb(h),l.Mb(T),l.Mb(m.b))},e.\u0275cmp=l.Gb({type:e,selectors:[["app-daily-expenses-line-chart"]],decls:3,vars:1,consts:[["fxFlex","","fxLayout","column"],[3,"startDateEmitter","endDateEmitter"],["fxFlex","","fxLayoutAlign","center center",4,"appLoading"],["fxFlex","","fxLayoutAlign","center center"],["baseChart","","chartType","line",3,"datasets","labels","options","colors","legend",4,"ngIf"],["baseChart","","chartType","line",3,"datasets","labels","options","colors","legend"]],template:function(e,t){1&e&&(l.Sb(0,"div",0),l.Sb(1,"app-datepicker",1),l.ac("startDateEmitter",(function(e){return t.listenToStartDate(e)}))("endDateEmitter",(function(e){return t.listenToEndDate(e)})),l.Rb(),l.zc(2,Pe,2,1,"div",2),l.Rb()),2&e&&(l.Bb(2),l.kc("appLoading",t.isLoading))},directives:[x.a,x.c,ke,U.a,x.b,D.m,Ce.a],styles:[""]}),e})();function Be(e,t){if(1&e&&l.Nb(0,"canvas",5),2&e){const e=l.ec(2);l.kc("datasets",e.chartData)("labels",e.chartLabels)("options",e.chartOptions)("legend",!1)}}function Fe(e,t){if(1&e&&(l.Sb(0,"div",3),l.zc(1,Be,1,4,"canvas",4),l.Rb()),2&e){const e=l.ec();l.Bb(1),l.kc("ngIf",e.chartData)}}let Me=(()=>{class e{constructor(e,t,a){this.expensesService=e,this.snackBar=t,this.dateService=a,this.expensesData=[],this.datasetSubject=new p.a(this.expensesData),this.chartData=[{data:this.expensesData.map(e=>e.expense)}],this.chartLabels=this.expensesData.map(e=>e.item),this.chartOptions={responsive:!0,scales:{xAxes:[{scaleLabel:{labelString:"Item",display:!0}}],yAxes:[{scaleLabel:{labelString:"Amount spent",display:!0},ticks:{beginAtZero:!0,maxTicksLimit:10,callback:e=>(new q).transform(e)}}]}},this.listenToStartDate=e=>{this.startDate=e,this.updateChartData()},this.listenToEndDate=e=>{this.endDate=e,this.updateChartData()},this.isLoading=!1,this.updateChartData=()=>{this.isLoading||(this.isLoading=!0,this.expensesData=[],this.expensesService.findAllDistinctItems(this.startDate,this.endDate).subscribe(e=>{e.success?(0===e.items.length&&this.datasetSubject.next(this.expensesData),e.items.forEach(this.updateItemData),this.isLoading=!1):(this.snackBar.open(e.msg,"",{panelClass:["error-snackbar"]}),this.datasetSubject.next(this.expensesData),this.isLoading=!1)}))},this.updateItemData=e=>{this.expensesService.getExpensesByItem(e,this.startDate,this.endDate).subscribe(t=>{if(t.success){let a=this.expensesData.map(e=>e.item).indexOf(e);-1==a?this.expensesData.push({item:e,expense:t.expense}):this.expensesData[a].expense!=t.expense&&(this.expensesData[a].expense=t.expense)}else this.snackBar.open(t.msg,"",{panelClass:["error-snackbar"]});this.datasetSubject.next(this.expensesData)})},this.startDate=this.dateService.addDays(this.dateService.today(),-7),this.endDate=this.dateService.today()}ngOnInit(){this.datasetSubject.asObservable().subscribe(()=>{this.chartData=[{data:this.expensesData.map(e=>e.expense),backgroundColor:this.expensesData.map(e=>e.expense>1e6?"rgba(200,0,0,0.3)":"rgba(34,139,34,0.3)")}],this.chartLabels=this.expensesData.map(e=>e.item)}),this.expensesService.refreshSubject.subscribe(this.updateChartData)}}return e.\u0275fac=function(t){return new(t||e)(l.Mb(h),l.Mb(m.b),l.Mb(T))},e.\u0275cmp=l.Gb({type:e,selectors:[["app-expenses-by-item"]],decls:3,vars:1,consts:[["fxFlex","","fxLayout","column"],[3,"startDateEmitter","endDateEmitter"],["fxFlex","","fxLayoutAlign","center center",4,"appLoading"],["fxFlex","","fxLayoutAlign","center center"],["baseChart","","chartType","bar",3,"datasets","labels","options","legend",4,"ngIf"],["baseChart","","chartType","bar",3,"datasets","labels","options","legend"]],template:function(e,t){1&e&&(l.Sb(0,"div",0),l.Sb(1,"app-datepicker",1),l.ac("startDateEmitter",(function(e){return t.listenToStartDate(e)}))("endDateEmitter",(function(e){return t.listenToEndDate(e)})),l.Rb(),l.zc(2,Fe,2,1,"div",2),l.Rb()),2&e&&(l.Bb(2),l.kc("appLoading",t.isLoading))},directives:[x.a,x.c,ke,U.a,x.b,D.m,Ce.a],styles:[""]}),e})();const Ie=[{path:"",component:xe,children:[{path:"list-of-expenses",component:ce},{path:"charts",component:(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Gb({type:e,selectors:[["app-expenses-charts"]],decls:2,vars:0,consts:[[2,"width","40vw"]],template:function(e,t){1&e&&(l.Nb(0,"app-daily-expenses-line-chart",0),l.Nb(1,"app-expenses-by-item",0))},directives:[we,Me],styles:[""]}),e})()},{path:"",pathMatch:"full",redirectTo:"list-of-expenses"},{path:"**",component:n.a}]}];let Ee=(()=>{class e{}return e.\u0275mod=l.Kb({type:e}),e.\u0275inj=l.Jb({factory:function(t){return new(t||e)},imports:[[i.d.forChild(Ie)],i.d]}),e})();var Le=a("PCNd");let Te=(()=>{class e{static forRoot(){return{ngModule:e}}}return e.\u0275mod=l.Kb({type:e}),e.\u0275inj=l.Jb({factory:function(t){return new(t||e)},imports:[[Le.a.forRoot(),Ee]]}),e})()}}]);