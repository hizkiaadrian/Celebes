(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"x+MQ":function(e,t,n){"use strict";n.r(t),n.d(t,"ExpensesManagerModule",(function(){return xt}));var i=n("tyNb"),a=n("QdL7"),s=n("+0xr"),o=n("M9IT"),r=n("R0Ic"),c=n("3Pt+"),l=function(e){return e.Kg="kg",e.Pcs="pcs",e.Gram="gram",e.Cc="cc",e.Ml="ml",e.Buah="buah",e}({}),b=n("fXoL"),d=n("1q3R"),p=n("tk/3"),u=n("AytR");let m=(()=>{class e{constructor(e){this.httpClient=e,this.addExpense=e=>this.httpClient.post(u.a.backendUrl+"/expenses/add-expense",e),this.editExpense=(e,t)=>this.httpClient.patch(`${u.a.backendUrl}/expenses/edit-expense/${t}`,{expense:e}),this.getAllExpenses=()=>this.httpClient.get(u.a.backendUrl+"/expenses/get-all-expenses"),this.deleteExpense=e=>this.httpClient.delete(`${u.a.backendUrl}/expenses/delete-expense/${e}`),this.getDailyExpensesInDateRange=(e,t)=>this.httpClient.get(u.a.backendUrl+"/expenses/get-daily-expenses-in-range",{params:(new p.f).set("startDate",e.toUTCString()).set("endDate",t.toUTCString())}),this.findAllDistinctItems=(e,t)=>this.httpClient.get(u.a.backendUrl+"/expenses/find-all-distinct-items",{params:(new p.f).set("startDate",e.toUTCString()).set("endDate",t.toUTCString())}),this.getExpensesByItem=(e,t,n)=>this.httpClient.get(`${u.a.backendUrl}/expenses/get-expenses-by-item/${e}`,{params:(new p.f).set("startDate",t.toUTCString()).set("endDate",n.toUTCString())})}}return e.\u0275fac=function(t){return new(t||e)(b.Wb(p.b))},e.\u0275prov=b.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var h=n("dNgK"),g=n("0IaG");let f=(()=>{class e{constructor(){this.onAmountChange=(e,t)=>{"amount"==t&&(e.value.pricePerUnit?e.patchValue({totalPrice:e.value.amount*e.value.pricePerUnit}):e.value.totalPrice&&e.patchValue({pricePerUnit:Math.round(e.value.totalPrice/e.value.amount)}))},this.onPricePerUnitChange=(e,t)=>{"pricePerUnit"===t&&e.patchValue({totalPrice:e.value.pricePerUnit*e.value.amount})},this.onTotalPriceChange=(e,t)=>{"totalPrice"===t&&e.value.amount&&e.patchValue({pricePerUnit:Math.round(e.value.totalPrice/e.value.amount)})}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=b.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var x=n("DUNq"),S=n("XiUz"),v=n("kmnG"),k=n("d3UM"),R=n("qFsG"),w=n("ofXK"),C=n("bTqV"),y=n("qUOr"),D=n("vxfF"),P=n("FKr1");function I(e,t){if(1&e&&(b.Sb(0,"mat-option",21),b.Ac(1),b.Rb()),2&e){const e=t.$implicit;b.kc("value",e.name),b.Bb(1),b.Cc(" ",e.name," ")}}function A(e,t){1&e&&(b.Sb(0,"mat-option",22),b.Ac(1," No entries match the search query "),b.Rb())}function B(e,t){if(1&e&&(b.Sb(0,"cdk-virtual-scroll-viewport",19),b.zc(1,I,2,2,"mat-option",20),b.zc(2,A,2,0,"mat-option",5),b.Rb()),2&e){const e=b.ec();b.wc("height",48*(e.listOfIngredients.length>5?5:e.listOfIngredients.length),"px"),b.kc("itemSize",48),b.Bb(1),b.kc("cdkVirtualForOf",e.selectedIngredients),b.Bb(1),b.kc("ngIf",0===e.selectedIngredients.length)}}function O(e,t){1&e&&(b.Sb(0,"mat-option",22),b.Ac(1," No ingredients yet.. "),b.Rb())}function M(e,t){1&e&&(b.Sb(0,"mat-error"),b.Ac(1," Item is required "),b.Rb())}function L(e,t){1&e&&(b.Sb(0,"mat-error"),b.Ac(1," Supplier is required "),b.Rb())}function F(e,t){1&e&&(b.Sb(0,"mat-error"),b.Ac(1," Amount is required "),b.Rb())}function E(e,t){if(1&e&&(b.Sb(0,"mat-option",21),b.Ac(1),b.Rb()),2&e){const e=t.$implicit;b.kc("value",e),b.Bb(1),b.Cc(" ",e," ")}}function z(e,t){1&e&&(b.Sb(0,"mat-error"),b.Ac(1," Price per unit is required "),b.Rb())}function T(e,t){1&e&&(b.Sb(0,"mat-error"),b.Ac(1," Total price is required "),b.Rb())}function U(e,t){1&e&&b.Nb(0,"div")}let _=(()=>{class e{constructor(e,t,n,i,a,s,o){this.formBuilder=e,this.authService=t,this.expensesService=n,this.snackBar=i,this.dialogRef=a,this.priceCalculatorService=s,this.ingredientsService=o,this.isSubmitting=!1,this.onAmountChange=()=>this.priceCalculatorService.onAmountChange(this.expensesForm,this.lastChanged),this.onPricePerUnitChange=()=>this.priceCalculatorService.onPricePerUnitChange(this.expensesForm,this.lastChanged),this.onTotalPriceChange=()=>this.priceCalculatorService.onTotalPriceChange(this.expensesForm,this.lastChanged)}get unitsOfMeasurement(){return Object.values(l)}ngOnInit(){this.subscription=this.authService.userSubject.subscribe(e=>this.loggedInUser=e),this.expensesForm=this.formBuilder.group({item:[this.expense.item,[c.w.required]],supplier:[this.expense.supplier,[c.w.required]],amount:[this.expense.amount,[c.w.required]],unit:[this.expense.unit,[c.w.required]],pricePerUnit:[this.expense.pricePerUnit,[c.w.required]],totalPrice:[this.expense.totalPrice,[c.w.required]]}),this.ingredientsService.getAllIngredients().subscribe(e=>{e.success?(this.listOfIngredients=e.ingredients,this.selectedIngredients=this.listOfIngredients):this.snackBar.open(e.msg,"",{panelClass:["error-snackbar"]})})}ngOnDestroy(){this.subscription.unsubscribe()}changeLastChanged(e){this.lastChanged=e}submit(){this.expensesForm.valid&&(this.isSubmitting=!0,this.expensesService.editExpense({item:this.expensesForm.value.item,supplier:this.expensesForm.value.supplier,amount:this.expensesForm.value.amount,unit:this.expensesForm.value.unit,pricePerUnit:this.expensesForm.value.pricePerUnit,totalPrice:this.expensesForm.value.totalPrice,dateOfExpense:this.expense.dateOfExpense,submittedBy:this.loggedInUser.name,invoiceId:this.expense.invoiceId},this.expense._id).subscribe(e=>{this.snackBar.open(e.msg,"",{panelClass:[e.success?"success-snackbar":"error-snackbar"]}),this.dialogRef.close()},()=>{this.snackBar.open("Something wrong has happened","",{panelClass:["error-snackbar"]}),this.isSubmitting=!1}))}search(e){let t=e.target.value.toLowerCase();this.selectedIngredients=this.listOfIngredients.filter(e=>e.name.toLowerCase().startsWith(t))}}return e.\u0275fac=function(t){return new(t||e)(b.Mb(c.f),b.Mb(d.a),b.Mb(m),b.Mb(h.b),b.Mb(g.d),b.Mb(f),b.Mb(x.a))},e.\u0275cmp=b.Gb({type:e,selectors:[["app-edit-expense-form"]],inputs:{expense:"expense",_id:"_id"},decls:41,vars:10,consts:[["fxFill","","fxLayoutAlign","center center"],["fxLayout","column","fxFlex","100%","fxFlex.gt-md","70%","autocomplete","off",3,"formGroup","ngSubmit"],["formControlName","item"],["matInput","","placeholder","Search","autocomplete","off",1,"search-input",3,"keyup"],[3,"itemSize","height",4,"ngIf"],["disabled","",4,"ngIf"],[4,"ngIf"],["matInput","","formControlName","supplier","type","text"],["fxLayout","row","fxLayoutGap","15px"],["fxFlex",""],["matInput","","formControlName","amount","type","number",3,"focus","ngModelChange"],[1,"auto-width"],["formControlName","unit"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","pricePerUnit","type","number",3,"focus","ngModelChange"],["matInput","","formControlName","totalPrice","type","number",3,"focus","ngModelChange"],["fxLayoutAlign","center"],["mat-raised-button","","color","primary","type","submit"],[4,"appLoading"],[3,"itemSize"],[3,"value",4,"cdkVirtualFor","cdkVirtualForOf"],[3,"value"],["disabled",""]],template:function(e,t){1&e&&(b.Sb(0,"div",0),b.Sb(1,"form",1),b.ac("ngSubmit",(function(){return t.submit()})),b.Sb(2,"h2"),b.Ac(3,"Edit expense"),b.Rb(),b.Sb(4,"mat-form-field"),b.Sb(5,"mat-label"),b.Ac(6,"Item"),b.Rb(),b.Sb(7,"mat-select",2),b.Sb(8,"input",3),b.ac("keyup",(function(e){return t.search(e)})),b.Rb(),b.zc(9,B,3,5,"cdk-virtual-scroll-viewport",4),b.zc(10,O,2,0,"mat-option",5),b.Rb(),b.zc(11,M,2,0,"mat-error",6),b.Rb(),b.Sb(12,"mat-form-field"),b.Sb(13,"mat-label"),b.Ac(14,"Supplier"),b.Rb(),b.Nb(15,"input",7),b.zc(16,L,2,0,"mat-error",6),b.Rb(),b.Sb(17,"div",8),b.Sb(18,"mat-form-field",9),b.Sb(19,"mat-label"),b.Ac(20,"Amount"),b.Rb(),b.Sb(21,"input",10),b.ac("focus",(function(){return t.changeLastChanged("amount")}))("ngModelChange",(function(){return t.onAmountChange()})),b.Rb(),b.zc(22,F,2,0,"mat-error",6),b.Rb(),b.Sb(23,"div",11),b.Sb(24,"mat-form-field"),b.Sb(25,"mat-select",12),b.zc(26,E,2,2,"mat-option",13),b.Rb(),b.Rb(),b.Rb(),b.Rb(),b.Sb(27,"mat-form-field"),b.Sb(28,"mat-label"),b.Ac(29,"Price per unit"),b.Rb(),b.Sb(30,"input",14),b.ac("focus",(function(){return t.changeLastChanged("pricePerUnit")}))("ngModelChange",(function(){return t.onPricePerUnitChange()})),b.Rb(),b.zc(31,z,2,0,"mat-error",6),b.Rb(),b.Sb(32,"mat-form-field"),b.Sb(33,"mat-label"),b.Ac(34,"Total price"),b.Rb(),b.Sb(35,"input",15),b.ac("focus",(function(){return t.changeLastChanged("totalPrice")}))("ngModelChange",(function(){return t.onTotalPriceChange()})),b.Rb(),b.zc(36,T,2,0,"mat-error",6),b.Rb(),b.Sb(37,"div",16),b.Sb(38,"button",17),b.Ac(39,"Submit"),b.Rb(),b.Rb(),b.Rb(),b.Rb(),b.zc(40,U,1,0,"div",18)),2&e&&(b.Bb(1),b.kc("formGroup",t.expensesForm),b.Bb(8),b.kc("ngIf",(null==t.listOfIngredients?null:t.listOfIngredients.length)>0),b.Bb(1),b.kc("ngIf",0===(null==t.listOfIngredients?null:t.listOfIngredients.length)),b.Bb(1),b.kc("ngIf",t.expensesForm.get("item").hasError("required")),b.Bb(5),b.kc("ngIf",t.expensesForm.get("supplier").hasError("required")),b.Bb(6),b.kc("ngIf",t.expensesForm.get("amount").hasError("required")),b.Bb(4),b.kc("ngForOf",t.unitsOfMeasurement),b.Bb(5),b.kc("ngIf",t.expensesForm.get("pricePerUnit").hasError("required")),b.Bb(5),b.kc("ngIf",t.expensesForm.get("totalPrice").hasError("required")),b.Bb(4),b.kc("appLoading",t.isSubmitting))},directives:[S.e,S.b,c.x,c.r,S.c,S.a,c.k,v.d,v.g,k.a,c.q,c.i,R.b,w.m,c.c,S.d,c.u,w.l,C.b,y.a,D.e,D.a,D.d,P.o,v.c],styles:[".auto-width .mat-form-field,   .auto-width .mat-form-field-infix{width:auto!important}  .auto-width .mat-select-value{max-width:100%;width:auto}.search-input[_ngcontent-%COMP%]{padding:10px;border:1px solid #323232;margin:5px;width:calc(100% - 35px)}.mat-option[_ngcontent-%COMP%]{margin:1rem 0;overflow:visible;word-wrap:break-word;white-space:pre-line}.mat-option[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{display:block}"]}),e})();function N(e,t){1&e&&b.Nb(0,"div")}let G=(()=>{class e{constructor(e,t,n){this.dialogRef=e,this.expensesService=t,this.snackBar=n,this.isSubmitting=!1}ngOnInit(){}goBack(){this.dialogRef.close()}confirmDelete(){this.isSubmitting=!0,this.expensesService.deleteExpense(this._id).subscribe(e=>{e.success?(this.snackBar.open("Expense deleted successfully","",{panelClass:["success-snackbar"]}),this.dialogRef.close()):(this.snackBar.open(e.msg,"",{panelClass:["error-snackbar"]}),this.isSubmitting=!1)})}}return e.\u0275fac=function(t){return new(t||e)(b.Mb(g.d),b.Mb(m),b.Mb(h.b))},e.\u0275cmp=b.Gb({type:e,selectors:[["app-delete-expense-form"]],inputs:{_id:"_id"},decls:11,vars:1,consts:[[1,"warn-text"],["fxLayout","row","fxLayoutGap","4px","fxLayoutAlign","end end"],["mat-stroked-button","","color","primary",3,"click"],["mat-raised-button","","color","warn",3,"click"],[4,"appLoading"]],template:function(e,t){1&e&&(b.Sb(0,"div"),b.Sb(1,"h2"),b.Ac(2,"Delete this entry?"),b.Rb(),b.Sb(3,"div",0),b.Ac(4,"This action cannot be undone"),b.Rb(),b.Sb(5,"div",1),b.Sb(6,"button",2),b.ac("click",(function(){return t.goBack()})),b.Ac(7,"Back"),b.Rb(),b.Sb(8,"button",3),b.ac("click",(function(){return t.confirmDelete()})),b.Ac(9,"Delete"),b.Rb(),b.Rb(),b.Rb(),b.zc(10,N,1,0,"div",4)),2&e&&(b.Bb(10),b.kc("appLoading",t.isSubmitting))},directives:[S.c,S.d,S.b,C.b,y.a],styles:[".warn-text[_ngcontent-%COMP%]{color:red}"]}),e})();var j=n("2pJz"),q=n("gx82");let $=(()=>{class e{constructor(e){this.http=e,this.getInvoiceById=e=>this.http.get(`${u.a.backendUrl}/invoices/get-invoice/${e}`)}}return e.\u0275fac=function(t){return new(t||e)(b.Wb(p.b))},e.\u0275prov=b.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function W(e,t){if(1&e&&b.Nb(0,"img",1),2&e){const e=b.ec();b.kc("src",e.invoiceImageUrl,b.sc)("alt",e.invoiceImageUrl)}}let V=(()=>{class e{constructor(e,t,n,i){this.imagesService=e,this.invoicesService=t,this.dialogRef=n,this.snackBar=i}ngOnInit(){this.invoicesService.getInvoiceById(this.invoiceId).subscribe(e=>{e.success?this.invoiceImageUrl=this.imagesService.getInvoice(e.invoice.imageUrl):(this.snackBar.open(e.msg,"",{panelClass:["error-snackbar"]}),this.dialogRef.close())})}}return e.\u0275fac=function(t){return new(t||e)(b.Mb(q.a),b.Mb($),b.Mb(g.d),b.Mb(h.b))},e.\u0275cmp=b.Gb({type:e,selectors:[["app-view-invoice-dialog"]],inputs:{invoiceId:"invoiceId"},decls:1,vars:1,consts:[[3,"src","alt",4,"ngIf"],[3,"src","alt"]],template:function(e,t){1&e&&b.zc(0,W,1,2,"img",0),2&e&&b.kc("ngIf",t.invoiceImageUrl)},directives:[w.m],styles:["img[_ngcontent-%COMP%]{width:100%;height:auto}"]}),e})(),Q=(()=>{class e{constructor(){this.ticksInADay=864e5,this.now=()=>new Date,this.today=()=>this.removeTime(new Date),this.addDays=(e,t)=>new Date(e.getTime()+t*this.ticksInADay),this.removeTime=e=>new Date(e.setHours(0,0,0))}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=b.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var H=n("NFeN"),K=n("Qu3c");let J=(()=>{class e{transform(e,...t){return"Rp "+new w.f("en-US").transform(e,"")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=b.Lb({name:"rupiah",type:e,pure:!0}),e})();function Z(e,t){1&e&&(b.Sb(0,"th",20),b.Ac(1," Date"),b.Rb())}function X(e,t){if(1&e&&(b.Sb(0,"td",21),b.Ac(1),b.fc(2,"date"),b.Rb()),2&e){const e=t.$implicit;b.Bb(1),b.Bc(b.hc(2,1,e.dateOfExpense,"d MMMM yyyy, HH:mm"))}}function Y(e,t){1&e&&(b.Sb(0,"th",20),b.Ac(1," Item"),b.Rb())}function ee(e,t){if(1&e&&(b.Sb(0,"td",21),b.Ac(1),b.Rb()),2&e){const e=t.$implicit;b.Bb(1),b.Bc(e.item)}}function te(e,t){1&e&&(b.Sb(0,"th",20),b.Ac(1," Supplier"),b.Rb())}function ne(e,t){if(1&e&&(b.Sb(0,"td",21),b.Ac(1),b.Rb()),2&e){const e=t.$implicit;b.Bb(1),b.Bc(e.supplier)}}function ie(e,t){1&e&&(b.Sb(0,"th",20),b.Ac(1," Amount"),b.Rb())}function ae(e,t){if(1&e&&(b.Sb(0,"td",21),b.Ac(1),b.Rb()),2&e){const e=t.$implicit;b.Bb(1),b.Dc("",e.amount," ",e.unit,"")}}function se(e,t){1&e&&(b.Sb(0,"th",20),b.Ac(1," Price/Unit"),b.Rb())}function oe(e,t){if(1&e&&(b.Sb(0,"td",21),b.Ac(1),b.fc(2,"rupiah"),b.Rb()),2&e){const e=t.$implicit;b.Bb(1),b.Bc(b.gc(2,1,e.pricePerUnit))}}function re(e,t){1&e&&(b.Sb(0,"th",20),b.Ac(1," Total Price"),b.Rb())}function ce(e,t){if(1&e&&(b.Sb(0,"td",21),b.Ac(1),b.fc(2,"rupiah"),b.Rb()),2&e){const e=t.$implicit;b.Bb(1),b.Bc(b.gc(2,1,e.totalPrice))}}function le(e,t){1&e&&(b.Sb(0,"th",20),b.Ac(1," Submitted by"),b.Rb())}function be(e,t){if(1&e&&(b.Sb(0,"td",21),b.Ac(1),b.Rb()),2&e){const e=t.$implicit;b.Bb(1),b.Bc(e.submittedBy)}}function de(e,t){if(1&e){const e=b.Tb();b.Sb(0,"td",21),b.Sb(1,"div",22),b.Sb(2,"div",23),b.Sb(3,"div",24),b.Ac(4),b.Rb(),b.Sb(5,"span",25),b.ac("click",(function(){b.rc(e);const n=t.$implicit;return b.ec(2).openViewInvoiceDialog(n.invoiceId)})),b.Ac(6,"View invoice"),b.Rb(),b.Rb(),b.Sb(7,"div",26),b.Sb(8,"button",27),b.ac("click",(function(){b.rc(e);const n=t.$implicit;return b.ec(2).openEditExpenseFormDialog(n)})),b.Sb(9,"mat-icon"),b.Ac(10,"edit"),b.Rb(),b.Rb(),b.Sb(11,"div",28),b.Sb(12,"button",29),b.ac("click",(function(){b.rc(e);const n=t.$implicit;return b.ec(2).openDeleteExpenseFormDialog(n._id)})),b.Sb(13,"mat-icon"),b.Ac(14,"delete"),b.Rb(),b.Rb(),b.Rb(),b.Rb(),b.Rb(),b.Rb()}if(2&e){const e=t.$implicit,n=b.ec(2);b.Cb("colspan",n.displayedColumns.length),b.Bb(1),b.kc("@detailExpand",e==n.expandedRow?"expanded":"collapsed"),b.Bb(3),b.Cc("Invoice ID: ",e.invoiceId||"No invoice ID",""),b.Bb(7),b.kc("matTooltipDisabled",n.isAuthorizedToDelete)("matTooltipPosition","below"),b.Bb(1),b.kc("disabled",!n.isAuthorizedToDelete)}}function pe(e,t){1&e&&b.Nb(0,"tr",30)}function ue(e,t){if(1&e){const e=b.Tb();b.Sb(0,"tr",31),b.ac("click",(function(){b.rc(e);const n=t.$implicit,i=b.ec(2);return i.expandedRow=i.expandedRow===n?null:n})),b.Rb()}}function me(e,t){1&e&&b.Nb(0,"tr",32)}function he(e,t){if(1&e&&(b.Sb(0,"tr",33),b.Sb(1,"td",34),b.Ac(2,"No data"),b.Rb(),b.Rb()),2&e){const e=b.ec(2);b.Bb(1),b.kc("colSpan",e.displayedColumns.length)}}const ge=function(){return["expandedDetail"]};function fe(e,t){if(1&e&&(b.Sb(0,"table",5),b.Qb(1,6),b.zc(2,Z,2,0,"th",7),b.zc(3,X,3,4,"td",8),b.Pb(),b.Qb(4,9),b.zc(5,Y,2,0,"th",7),b.zc(6,ee,2,1,"td",8),b.Pb(),b.Qb(7,10),b.zc(8,te,2,0,"th",7),b.zc(9,ne,2,1,"td",8),b.Pb(),b.Qb(10,11),b.zc(11,ie,2,0,"th",7),b.zc(12,ae,2,2,"td",8),b.Pb(),b.Qb(13,12),b.zc(14,se,2,0,"th",7),b.zc(15,oe,3,3,"td",8),b.Pb(),b.Qb(16,13),b.zc(17,re,2,0,"th",7),b.zc(18,ce,3,3,"td",8),b.Pb(),b.Qb(19,14),b.zc(20,le,2,0,"th",7),b.zc(21,be,2,1,"td",8),b.Pb(),b.Qb(22,15),b.zc(23,de,15,6,"td",8),b.Pb(),b.zc(24,pe,1,0,"tr",16),b.zc(25,ue,1,0,"tr",17),b.zc(26,me,1,0,"tr",18),b.zc(27,he,3,1,"tr",19),b.Rb()),2&e){const e=b.ec();b.kc("dataSource",e.dataSource),b.Bb(24),b.kc("matHeaderRowDef",e.displayedColumns),b.Bb(1),b.kc("matRowDefColumns",e.displayedColumns),b.Bb(1),b.kc("matRowDefColumns",b.lc(4,ge))}}const xe=function(){return[5,10]};let Se=(()=>{class e{constructor(e,t,n,i){this.expensesService=e,this.authService=t,this.dialog=n,this.dateService=i,this.displayedColumns=["date","item","supplier","amount","pricePerUnit","totalPrice","submittedBy"],this.populateDataSourceWithExpenses=()=>{this.expensesService.getAllExpenses().subscribe(e=>{this.dataSource=new s.l(e.expenses),this.dataSource.paginator=this.paginator,this.lastUpdated=this.dateService.now()})}}ngOnInit(){this.populateDataSourceWithExpenses(),this.userSubscription=this.authService.userSubject.subscribe(e=>{e&&(this.isAuthorizedToDelete=this.authService.getUserRole()!==j.a.Employee)})}ngOnDestroy(){this.userSubscription.unsubscribe()}openEditExpenseFormDialog(e){let t=this.dialog.open(_);t.componentInstance.expense=e,t.afterClosed().subscribe(this.populateDataSourceWithExpenses)}openDeleteExpenseFormDialog(e){let t=this.dialog.open(G);t.componentInstance._id=e,t.afterClosed().subscribe(this.populateDataSourceWithExpenses)}openViewInvoiceDialog(e){this.dialog.open(V,{panelClass:["padding-less-dialog"]}).componentInstance.invoiceId=e}}return e.\u0275fac=function(t){return new(t||e)(b.Mb(m),b.Mb(d.a),b.Mb(g.b),b.Mb(Q))},e.\u0275cmp=b.Gb({type:e,selectors:[["app-list-of-expenses"]],viewQuery:function(e,t){var n;1&e&&b.vc(o.a,!0),2&e&&b.oc(n=b.bc())&&(t.paginator=n.first)},decls:7,vars:8,consts:[["fxFlex","","fxLayout","column"],[1,"mat-h3","last-updated"],[1,"table-parent"],["mat-table","","multiTemplateDataRows","",3,"dataSource",4,"appLoading"],[3,"pageSizeOptions","pageSize"],["mat-table","","multiTemplateDataRows","",3,"dataSource"],["matColumnDef","date"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","item"],["matColumnDef","supplier"],["matColumnDef","amount"],["matColumnDef","pricePerUnit"],["matColumnDef","totalPrice"],["matColumnDef","submittedBy"],["matColumnDef","expandedDetail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","clickable",3,"click",4,"matRowDef","matRowDefColumns"],["mat-row","","class","hidden-row",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["mat-header-cell",""],["mat-cell",""],["fxLayout","row","fxLayoutAlign","space-evenly center",1,"expanded-row"],[1,"expanded-detail"],[1,"mb-5px"],[3,"click"],["fxLayout","row"],["mat-mini-fab","","color","primary","aria-label","Edit",1,"mr-4px",3,"click"],["matTooltip","Must be a manager or above to delete",3,"matTooltipDisabled","matTooltipPosition"],["mat-mini-fab","","color","warn","aria-label","Delete",3,"disabled","click"],["mat-header-row",""],["mat-row","",1,"clickable",3,"click"],["mat-row","",1,"hidden-row"],[1,"mat-row"],[1,"mat-cell",3,"colSpan"]],template:function(e,t){1&e&&(b.Sb(0,"div",0),b.Sb(1,"h5",1),b.Ac(2),b.fc(3,"date"),b.Rb(),b.Sb(4,"div",2),b.zc(5,fe,28,5,"table",3),b.Rb(),b.Nb(6,"mat-paginator",4),b.Rb()),2&e&&(b.Bb(2),b.Cc("Last updated: ",b.hc(3,4,t.lastUpdated,"short"),""),b.Bb(3),b.kc("appLoading",void 0===t.dataSource),b.Bb(1),b.kc("pageSizeOptions",b.lc(7,xe))("pageSize",10))},directives:[S.a,S.c,y.a,o.a,s.k,s.c,s.e,s.b,s.g,s.j,s.h,s.d,s.a,S.b,C.b,H.a,K.a,s.f,s.i],pipes:[w.e,J],styles:[".table-parent[_ngcontent-%COMP%]{min-width:600px;overflow-x:auto}table[_ngcontent-%COMP%]{width:100%}.last-updated[_ngcontent-%COMP%]{margin:20px 0 0 20px}.mat-form-field[_ngcontent-%COMP%]{font-size:14px;width:100%}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{width:auto}.mat-cell[_ngcontent-%COMP%]{text-align:left}.clickable[_ngcontent-%COMP%]{cursor:pointer}.hidden-row[_ngcontent-%COMP%]{height:0}.expanded-row[_ngcontent-%COMP%]{overflow:hidden}.expanded-detail[_ngcontent-%COMP%]{padding:10px 0;margin:50px 0}.mr-4px[_ngcontent-%COMP%]{margin-right:4px}.mb-5px[_ngcontent-%COMP%]{margin-bottom:5px}span[_ngcontent-%COMP%]{cursor:pointer;color:#00f;text-decoration:underline}span[_ngcontent-%COMP%]:hover{text-decoration:none;text-shadow:1px 1px 1px #555}"],data:{animation:[Object(r.n)("detailExpand",[Object(r.k)("collapsed",Object(r.l)({height:"0px",minHeight:"0"})),Object(r.k)("expanded",Object(r.l)({height:"*"})),Object(r.m)("expanded <=> collapsed",Object(r.e)("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]}}),e})();var ve=n("wZkO");let ke=(()=>{class e{constructor(e,t){this.dialog=e,this.router=t,this.dashboardTitle="Expenses Manager"}}return e.\u0275fac=function(t){return new(t||e)(b.Mb(g.b),b.Mb(i.b))},e.\u0275cmp=b.Gb({type:e,selectors:[["app-dashboard"]],decls:14,vars:6,consts:[["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","start center"],["mat-button","","color","primary",3,"routerLink"],["aria-label","Add"],[1,"mat-h3"],["mat-tab-nav-bar",""],["mat-tab-link","",3,"routerLink","active"]],template:function(e,t){1&e&&(b.Sb(0,"div",0),b.Sb(1,"h1"),b.Ac(2),b.Rb(),b.Sb(3,"button",1),b.Sb(4,"mat-icon",2),b.Ac(5,"library_add"),b.Rb(),b.Sb(6,"div",3),b.Ac(7,"Add a new expense"),b.Rb(),b.Rb(),b.Rb(),b.Sb(8,"nav",4),b.Sb(9,"a",5),b.Ac(10,"List of Expenses"),b.Rb(),b.Sb(11,"a",5),b.Ac(12,"Charts"),b.Rb(),b.Rb(),b.Nb(13,"router-outlet")),2&e&&(b.Bb(2),b.Bc(t.dashboardTitle),b.Bb(1),b.kc("routerLink","add-new-expense"),b.Bb(6),b.kc("routerLink","list-of-expenses")("active",t.router.url.endsWith("list-of-expenses")),b.Bb(2),b.kc("routerLink","charts")("active",t.router.url.endsWith("charts")))},directives:[S.c,S.d,S.b,C.b,i.c,H.a,ve.b,i.d,ve.a,i.f],styles:["button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:5px}button[_ngcontent-%COMP%]   .mat-h3[_ngcontent-%COMP%]{display:inline}"]}),e})();var Re=function(e){return e[e.ThisWeek=0]="ThisWeek",e[e.ThisMonth=1]="ThisMonth",e[e.Custom=2]="Custom",e}({}),we=n("QibW"),Ce=n("iadO");let ye=(()=>{class e{constructor(e,t){this.formBuilder=e,this.dateService=t,this.startDateEmitter=new b.o,this.endDateEmitter=new b.o,this.today=this.dateService.today(),this.lastWeek=this.dateService.addDays(this.today,-7),this.lastMonth=this.dateService.addDays(this.today,-30),this.datePickerForm=this.formBuilder.group({mode:[Re.ThisWeek],startDate:[{value:this.lastWeek,disabled:!0}],endDate:[{value:this.today,disabled:!0}]}),this.emitStartDateInput=()=>{this.startDateEmitter.emit(this.datePickerForm.get("startDate").value)},this.emitEndDateInput=()=>{this.endDateEmitter.emit(this.datePickerForm.get("endDate").value)}}get datepickerMode(){return Re}ngOnInit(){this.emitStartDateInput(),this.emitEndDateInput()}updateDateRangeAndToggleFormDisable(){switch(this.datePickerForm.get("mode").value){case Re.ThisWeek:this.datePickerForm.patchValue({startDate:this.lastWeek,endDate:this.today}),this.datePickerForm.controls.startDate.disable(),this.datePickerForm.controls.endDate.disable();break;case Re.ThisMonth:this.datePickerForm.patchValue({startDate:this.lastMonth,endDate:this.today}),this.datePickerForm.controls.startDate.disable(),this.datePickerForm.controls.endDate.disable();break;case Re.Custom:this.datePickerForm.controls.startDate.enable(),this.datePickerForm.controls.endDate.enable()}}}return e.\u0275fac=function(t){return new(t||e)(b.Mb(c.f),b.Mb(Q))},e.\u0275cmp=b.Gb({type:e,selectors:[["app-datepicker"]],outputs:{startDateEmitter:"startDateEmitter",endDateEmitter:"endDateEmitter"},decls:24,vars:9,consts:[["fxLayout","column",1,"pt-20px"],[3,"formGroup"],["formControlName","mode","aria-label","Select an option","fxLayout","row","fxLayoutGap","40px","fxLayoutAlign","center",1,"ml-5px",3,"ngModelChange"],[3,"checked","value"],[3,"value"],["fxLayout","row","fxLayoutGap","20px","fxLayoutAlign","center"],["matInput","","formControlName","startDate",3,"matDatepicker","ngModelChange"],["matSuffix","",3,"for"],["startDatePicker",""],["matInput","","formControlName","endDate",3,"matDatepicker","ngModelChange"],["endDatePicker",""]],template:function(e,t){if(1&e&&(b.Sb(0,"div",0),b.Sb(1,"form",1),b.Sb(2,"mat-radio-group",2),b.ac("ngModelChange",(function(){return t.updateDateRangeAndToggleFormDisable()})),b.Sb(3,"mat-radio-button",3),b.Ac(4,"This week "),b.Rb(),b.Sb(5,"mat-radio-button",4),b.Ac(6,"This month"),b.Rb(),b.Sb(7,"mat-radio-button",4),b.Ac(8,"Custom"),b.Rb(),b.Rb(),b.Sb(9,"div",5),b.Sb(10,"mat-form-field"),b.Sb(11,"mat-label"),b.Ac(12,"Start date"),b.Rb(),b.Sb(13,"input",6),b.ac("ngModelChange",(function(){return t.emitStartDateInput()})),b.Rb(),b.Nb(14,"mat-datepicker-toggle",7),b.Nb(15,"mat-datepicker",null,8),b.Rb(),b.Sb(17,"mat-form-field"),b.Sb(18,"mat-label"),b.Ac(19,"End date"),b.Rb(),b.Sb(20,"input",9),b.ac("ngModelChange",(function(){return t.emitEndDateInput()})),b.Rb(),b.Nb(21,"mat-datepicker-toggle",7),b.Nb(22,"mat-datepicker",null,10),b.Rb(),b.Rb(),b.Rb(),b.Rb()),2&e){const e=b.pc(16),n=b.pc(23);b.Bb(1),b.kc("formGroup",t.datePickerForm),b.Bb(2),b.kc("checked",t.datePickerForm.get("mode").value===t.datepickerMode.ThisWeek)("value",t.datepickerMode.ThisWeek),b.Bb(2),b.kc("value",t.datepickerMode.ThisMonth),b.Bb(2),b.kc("value",t.datepickerMode.Custom),b.Bb(6),b.kc("matDatepicker",e),b.Bb(1),b.kc("for",e),b.Bb(6),b.kc("matDatepicker",n),b.Bb(1),b.kc("for",n)}},directives:[S.c,c.x,c.r,c.k,we.b,c.q,c.i,S.d,S.b,we.a,v.d,v.g,R.b,c.c,Ce.b,Ce.d,v.h,Ce.a],styles:[".ml-5px[_ngcontent-%COMP%]{margin-left:5px}.pt-20px[_ngcontent-%COMP%]{padding-top:20px}"]}),e})();var De=n("wd/R"),Pe=n("LPYB");const Ie=function(){return{borderColor:"black",backgroundColor:"rgba(0,0,0,0)"}},Ae=function(e){return[e]};function Be(e,t){if(1&e&&b.Nb(0,"canvas",4),2&e){const e=b.ec(2);b.kc("datasets",e.chartData)("labels",e.chartLabels)("options",e.chartOptions)("colors",b.mc(6,Ae,b.lc(5,Ie)))("legend",!1)}}function Oe(e,t){1&e&&(b.Sb(0,"div"),b.Ac(1,"No expenses to show"),b.Rb())}function Me(e,t){if(1&e&&(b.Sb(0,"div",1),b.Sb(1,"h4"),b.Ac(2,"Daily expenses"),b.Rb(),b.zc(3,Be,1,8,"canvas",2),b.zc(4,Oe,2,0,"div",3),b.Rb()),2&e){const e=b.ec();b.Bb(3),b.kc("ngIf",e.chartData[0].data.some(e.greaterThanZero)),b.Bb(1),b.kc("ngIf",0===e.chartData[0].data.filter(e.greaterThanZero).length)}}let Le=(()=>{class e{constructor(e,t,n){this.expensesService=e,this.dateService=t,this.snackBar=n,this.isLoading=!1,this.expensesData=[],this.chartOptions={responsive:!0,scales:{xAxes:[{scaleLabel:{labelString:"Date",display:!0},ticks:{maxTicksLimit:10}}],yAxes:[{scaleLabel:{labelString:"Amount spent",display:!0},ticks:{maxTicksLimit:10,callback:e=>(new J).transform(e).toString()}}]}},this.updateChartData=()=>{this.isLoading||(this.isLoading=!0,this.expensesService.getDailyExpensesInDateRange(this.startDate,this.endDate).subscribe(e=>{e.success?(this.expensesData=e.expenses.sort(Fe),this.chartData=[{data:this.expensesData.map(e=>e.expense)}],this.chartLabels=this.expensesData.map(e=>De(e.date).format("D MMM"))):this.snackBar.open(e.msg,"",{panelClass:["error-snackbar"]}),this.isLoading=!1}))}}ngOnInit(){}ngOnChanges(){this.startDate&&this.endDate&&this.updateChartData()}greaterThanZero(e){return e>0}}return e.\u0275fac=function(t){return new(t||e)(b.Mb(m),b.Mb(Q),b.Mb(h.b))},e.\u0275cmp=b.Gb({type:e,selectors:[["app-daily-expenses-line-chart"]],inputs:{startDate:"startDate",endDate:"endDate"},features:[b.zb],decls:1,vars:1,consts:[["fxFlex","","fxLayout","column","fxLayoutAlign","center center",4,"appLoading"],["fxFlex","","fxLayout","column","fxLayoutAlign","center center"],["baseChart","","chartType","line",3,"datasets","labels","options","colors","legend",4,"ngIf"],[4,"ngIf"],["baseChart","","chartType","line",3,"datasets","labels","options","colors","legend"]],template:function(e,t){1&e&&b.zc(0,Me,5,2,"div",0),2&e&&b.kc("appLoading",t.isLoading)},directives:[y.a,S.a,S.c,S.b,w.m,Pe.a],styles:[""]}),e})();const Fe=(e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime();var Ee=n("2Vo4"),ze=n("LRne"),Te=n("eIep"),Ue=n("lJxs");function _e(e,t){if(1&e&&b.Nb(0,"canvas",4),2&e){const e=b.ec(2);b.kc("datasets",e.chartData)("labels",e.chartLabels)("options",e.chartOptions)("legend",!1)}}function Ne(e,t){1&e&&(b.Sb(0,"div"),b.Ac(1,"No expenses to show"),b.Rb())}function Ge(e,t){if(1&e&&(b.Sb(0,"div",1),b.Sb(1,"h4"),b.Ac(2,"Expenses by item"),b.Rb(),b.zc(3,_e,1,4,"canvas",2),b.zc(4,Ne,2,0,"div",3),b.Rb()),2&e){const e=b.ec();b.Bb(3),b.kc("ngIf",e.chartData[0].data.length>0),b.Bb(1),b.kc("ngIf",0===e.chartData[0].data.length)}}let je=(()=>{class e{constructor(e,t){this.expensesService=e,this.snackBar=t,this.isLoading=!1,this.expensesData=[],this.datasetSubject=new Ee.a(this.expensesData),this.chartData=[{data:this.expensesData.map(e=>e.expense)}],this.chartLabels=this.expensesData.map(e=>e.item),this.chartOptions={responsive:!0,scales:{xAxes:[{scaleLabel:{labelString:"Item",display:!0}}],yAxes:[{scaleLabel:{labelString:"Amount spent",display:!0},ticks:{beginAtZero:!0,maxTicksLimit:10,callback:e=>(new J).transform(e)}}]}},this.updateChartData=()=>{this.isLoading||(this.isLoading=!0,this.expensesData=[],this.datasetSubject.next(this.expensesData),this.expensesService.findAllDistinctItems(this.startDate,this.endDate).pipe(Object(Te.a)(e=>e.success?Object(ze.a)(e.items):(this.snackBar.open(e.msg,"",{panelClass:["error-snackbar"]}),Object(ze.a)(null)))).subscribe(e=>{e&&e.length>0?e.map(t=>this.updateItemData(t).subscribe(t=>{this.expensesData.push(t),this.expensesData.length===e.length&&(this.datasetSubject.next(this.expensesData),this.isLoading=!1)})):(this.datasetSubject.next(this.expensesData),this.isLoading=!1)}))},this.updateItemData=e=>this.expensesService.getExpensesByItem(e,this.startDate,this.endDate).pipe(Object(Ue.a)(t=>({item:e,expense:t.expense})))}ngOnInit(){this.subscription=this.datasetSubject.subscribe(()=>{this.chartData=[{data:this.expensesData.map(e=>e.expense),backgroundColor:this.expensesData.map(e=>e.expense>1e6?"rgba(200,0,0,0.3)":"rgba(34,139,34,0.3)")}],this.chartLabels=this.expensesData.map(e=>e.item)})}ngOnDestroy(){this.subscription.unsubscribe()}ngOnChanges(){this.startDate&&this.endDate&&this.updateChartData()}}return e.\u0275fac=function(t){return new(t||e)(b.Mb(m),b.Mb(h.b))},e.\u0275cmp=b.Gb({type:e,selectors:[["app-expenses-by-item"]],inputs:{startDate:"startDate",endDate:"endDate"},features:[b.zb],decls:1,vars:1,consts:[["fxFlex","","fxLayout","column","fxLayoutAlign","center center",4,"appLoading"],["fxFlex","","fxLayout","column","fxLayoutAlign","center center"],["baseChart","","chartType","bar",3,"datasets","labels","options","legend",4,"ngIf"],[4,"ngIf"],["baseChart","","chartType","bar",3,"datasets","labels","options","legend"]],template:function(e,t){1&e&&b.zc(0,Ge,5,2,"div",0),2&e&&b.kc("appLoading",t.isLoading)},directives:[y.a,S.a,S.c,S.b,w.m,Pe.a],styles:[""]}),e})(),qe=(()=>{class e{constructor(){this.listenToStartDate=e=>this.startDate=e,this.listenToEndDate=e=>this.endDate=e}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=b.Gb({type:e,selectors:[["app-expenses-charts"]],decls:4,vars:4,consts:[["fxFlex","","fxLayout","column","fxLayoutAlign","start center"],[3,"startDateEmitter","endDateEmitter"],[1,"chart",3,"startDate","endDate"]],template:function(e,t){1&e&&(b.Sb(0,"div",0),b.Sb(1,"app-datepicker",1),b.ac("startDateEmitter",(function(e){return t.listenToStartDate(e)}))("endDateEmitter",(function(e){return t.listenToEndDate(e)})),b.Rb(),b.Nb(2,"app-daily-expenses-line-chart",2),b.Nb(3,"app-expenses-by-item",2),b.Rb()),2&e&&(b.Bb(2),b.kc("startDate",t.startDate)("endDate",t.endDate),b.Bb(1),b.kc("startDate",t.startDate)("endDate",t.endDate))},directives:[S.a,S.c,S.b,ye,Le,je],styles:[".chart[_ngcontent-%COMP%]{width:100%;max-width:700px}"]}),e})();var $e=n("pLZG"),We=n("xHqg");let Ve=(()=>{class e{constructor(e){this.snackBar=e,this.fileEmitter=new b.o,this.selectFile=e=>{this.fileToUpload=null,e.target.files[0]&&0!=e.target.files[0].length?null!=e.target.files[0].type.match(/image\/*/)?(this.fileToUpload=e.target.files[0],this.fileEmitter.emit(this.fileToUpload)):this.snackBar.open("Only images are supported","",{panelClass:["error-snackbar"]}):this.snackBar.open("You must select an image ","",{panelClass:["error-snackbar"]})}}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(b.Mb(h.b))},e.\u0275cmp=b.Gb({type:e,selectors:[["app-upload-invoice"]],inputs:{uploadInvoiceForm:"uploadInvoiceForm"},outputs:{fileEmitter:"fileEmitter"},decls:10,vars:2,consts:[["fxLayout","column","fxLayoutGap","10px","fxLayoutAlign","space-evenly start"],["fxLayout","row","fxLayoutGap","20px","fxLayoutAlign","start center"],["mat-flat-button","","color","primary",3,"click"],["type","file","accept","image/jpeg, image/png",1,"input-file",3,"change"],["inputFile",""],["mat-flat-button","","color","primary","matStepperNext","",3,"disabled"]],template:function(e,t){if(1&e){const e=b.Tb();b.Sb(0,"div",0),b.Sb(1,"div",1),b.Sb(2,"button",2),b.ac("click",(function(){return b.rc(e),b.pc(7).click()})),b.Ac(3,"Choose file from device"),b.Rb(),b.Sb(4,"div"),b.Ac(5),b.Rb(),b.Sb(6,"input",3,4),b.ac("change",(function(e){return t.selectFile(e)})),b.Rb(),b.Rb(),b.Sb(8,"button",5),b.Ac(9,"Next"),b.Rb(),b.Rb()}2&e&&(b.Bb(5),b.Bc(null==t.fileToUpload?null:t.fileToUpload.name),b.Bb(3),b.kc("disabled",!t.uploadInvoiceForm.controls.invoice.valid))},directives:[S.c,S.d,S.b,C.b,We.c],styles:[".input-file[_ngcontent-%COMP%]{display:none}"]}),e})();function Qe(e,t){1&e&&(b.Sb(0,"mat-icon",26),b.Ac(1,"error"),b.Rb())}function He(e,t){1&e&&(b.Sb(0,"mat-icon",27),b.Ac(1,"check_circle "),b.Rb())}function Ke(e,t){if(1&e&&(b.Sb(0,"mat-option",30),b.Ac(1),b.Rb()),2&e){const e=t.$implicit;b.kc("value",e.name),b.Bb(1),b.Cc(" ",e.name," ")}}function Je(e,t){1&e&&(b.Sb(0,"mat-option",31),b.Ac(1," No entries match the search query "),b.Rb())}function Ze(e,t){if(1&e&&(b.Sb(0,"cdk-virtual-scroll-viewport",28),b.zc(1,Ke,2,2,"mat-option",29),b.zc(2,Je,2,0,"mat-option",17),b.Rb()),2&e){const e=b.ec(2);b.wc("height",48*(e.listOfIngredients.length>5?5:e.listOfIngredients.length),"px"),b.kc("itemSize",48),b.Bb(1),b.kc("cdkVirtualForOf",e.selectedIngredients),b.Bb(1),b.kc("ngIf",0===e.selectedIngredients.length)}}function Xe(e,t){1&e&&(b.Sb(0,"mat-option",31),b.Ac(1," No ingredients yet "),b.Rb())}function Ye(e,t){if(1&e&&(b.Sb(0,"mat-option",30),b.Ac(1),b.Rb()),2&e){const e=t.$implicit;b.kc("value",e),b.Bb(1),b.Cc(" ",e," ")}}function et(e,t){if(1&e){const e=b.Tb();b.Qb(0,8),b.Sb(1,"tr",9),b.Sb(2,"td",10),b.zc(3,Qe,2,0,"mat-icon",11),b.zc(4,He,2,0,"mat-icon",12),b.Rb(),b.Sb(5,"td"),b.Sb(6,"div",13),b.Sb(7,"mat-select",14),b.Sb(8,"input",15),b.ac("keyup",(function(t){return b.rc(e),b.ec().search(t)})),b.Rb(),b.zc(9,Ze,3,5,"cdk-virtual-scroll-viewport",16),b.zc(10,Xe,2,0,"mat-option",17),b.Rb(),b.Rb(),b.Rb(),b.Sb(11,"td"),b.Sb(12,"div"),b.Nb(13,"input",18),b.Rb(),b.Rb(),b.Sb(14,"td"),b.Sb(15,"div"),b.Sb(16,"input",19),b.ac("focus",(function(){return b.rc(e),b.ec().changeLastChanged("amount")}))("ngModelChange",(function(){b.rc(e);const n=t.index;return b.ec().onAmountChange(n)})),b.Rb(),b.Rb(),b.Rb(),b.Sb(17,"td"),b.Sb(18,"div",20),b.Sb(19,"mat-select",21),b.zc(20,Ye,2,2,"mat-option",22),b.Rb(),b.Rb(),b.Rb(),b.Sb(21,"td"),b.Sb(22,"div"),b.Sb(23,"input",23),b.ac("focus",(function(){return b.rc(e),b.ec().changeLastChanged("pricePerUnit")}))("ngModelChange",(function(){b.rc(e);const n=t.index;return b.ec().onPricePerUnitChange(n)})),b.Rb(),b.Rb(),b.Rb(),b.Sb(24,"td"),b.Sb(25,"div"),b.Sb(26,"input",24),b.ac("focus",(function(){return b.rc(e),b.ec().changeLastChanged("totalPrice")}))("ngModelChange",(function(){b.rc(e);const n=t.index;return b.ec().onTotalPriceChange(n)})),b.Rb(),b.Rb(),b.Rb(),b.Sb(27,"td",10),b.Sb(28,"mat-icon",25),b.ac("click",(function(){b.rc(e);const n=t.index;return b.ec().emitRemoveRow(n)})),b.Ac(29,"delete"),b.Rb(),b.Rb(),b.Rb(),b.Pb()}if(2&e){const e=t.index,n=b.ec();b.Bb(1),b.kc("formGroupName",e),b.Bb(2),b.kc("ngIf",n.addExpensesForm.controls.expenses.controls[e].invalid),b.Bb(1),b.kc("ngIf",n.addExpensesForm.controls.expenses.controls[e].valid),b.Bb(5),b.kc("ngIf",(null==n.listOfIngredients?null:n.listOfIngredients.length)>0),b.Bb(1),b.kc("ngIf",0===(null==n.listOfIngredients?null:n.listOfIngredients.length)),b.Bb(10),b.kc("ngForOf",n.unitsOfMeasurement)}}let tt=(()=>{class e{constructor(e,t,n){this.priceCalculatorService=e,this.ingredientsService=t,this.snackBar=n,this.addRow=new b.o,this.deleteRow=new b.o,this.emitAddRow=()=>this.addRow.emit(null),this.emitRemoveRow=e=>this.deleteRow.emit(e),this.changeLastChanged=e=>this.lastChanged=e,this.onAmountChange=e=>this.priceCalculatorService.onAmountChange(this.addExpensesForm.controls.expenses.controls[e],this.lastChanged),this.onPricePerUnitChange=e=>this.priceCalculatorService.onPricePerUnitChange(this.addExpensesForm.controls.expenses.controls[e],this.lastChanged),this.onTotalPriceChange=e=>this.priceCalculatorService.onTotalPriceChange(this.addExpensesForm.controls.expenses.controls[e],this.lastChanged)}get unitsOfMeasurement(){return Object.values(l)}ngOnInit(){this.ingredientsService.getAllIngredients().subscribe(e=>{e.success?(this.listOfIngredients=e.ingredients,this.selectedIngredients=this.listOfIngredients):this.snackBar.open(e.msg,"",{panelClass:["error-snackbar"]})})}search(e){let t=e.target.value.toLowerCase();this.selectedIngredients=this.listOfIngredients.filter(e=>e.name.toLowerCase().startsWith(t))}}return e.\u0275fac=function(t){return new(t||e)(b.Mb(f),b.Mb(x.a),b.Mb(h.b))},e.\u0275cmp=b.Gb({type:e,selectors:[["app-add-expenses"]],inputs:{addExpensesForm:"addExpensesForm"},outputs:{addRow:"addRow",deleteRow:"deleteRow"},decls:30,vars:3,consts:[["fxLayout","column","fxLayoutGap","10px","fxLayoutAlign","space-evenly stretch"],["fxFlex","",3,"formGroup"],["formArrayName","expenses",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","end"],["mat-mini-fab","","color","accent",3,"click"],["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","center center"],["mat-stroked-button","","color","accent","matStepperPrevious","","type","button"],["mat-flat-button","","color","primary","matStepperNext","","type","button",3,"disabled"],["formArrayName","expenses"],[3,"formGroupName"],[1,"table-row-number"],["color","warn",4,"ngIf"],["class","green-check",4,"ngIf"],[1,"item-input"],["formControlName","item"],["matInput","","placeholder","Search","autocomplete","off",1,"search-input",3,"keyup"],[3,"itemSize","height",4,"ngIf"],["disabled","",4,"ngIf"],["formControlName","supplier","type","text"],["formControlName","amount","type","number",3,"focus","ngModelChange"],[1,"auto-width"],["formControlName","unit"],[3,"value",4,"ngFor","ngForOf"],["formControlName","pricePerUnit","type","number",3,"focus","ngModelChange"],["formControlName","totalPrice","type","number",3,"focus","ngModelChange"],["color","warn",1,"clickable",3,"click"],["color","warn"],[1,"green-check"],[3,"itemSize"],[3,"value",4,"cdkVirtualFor","cdkVirtualForOf"],[3,"value"],["disabled",""]],template:function(e,t){1&e&&(b.Sb(0,"div",0),b.Sb(1,"form",1),b.Sb(2,"table"),b.Sb(3,"thead"),b.Sb(4,"tr"),b.Nb(5,"th"),b.Sb(6,"th"),b.Ac(7,"Item"),b.Rb(),b.Sb(8,"th"),b.Ac(9,"Supplier"),b.Rb(),b.Sb(10,"th"),b.Ac(11,"Amount"),b.Rb(),b.Sb(12,"th"),b.Ac(13,"Unit"),b.Rb(),b.Sb(14,"th"),b.Ac(15,"Price/Unit"),b.Rb(),b.Sb(16,"th"),b.Ac(17,"Total price"),b.Rb(),b.Nb(18,"th"),b.Rb(),b.Rb(),b.Sb(19,"tbody"),b.zc(20,et,30,6,"ng-container",2),b.Rb(),b.Rb(),b.Rb(),b.Sb(21,"div",3),b.Sb(22,"button",4),b.ac("click",(function(){return t.emitAddRow()})),b.Sb(23,"mat-icon"),b.Ac(24,"add"),b.Rb(),b.Rb(),b.Rb(),b.Sb(25,"div",5),b.Sb(26,"button",6),b.Ac(27,"Previous"),b.Rb(),b.Sb(28,"button",7),b.Ac(29,"Next "),b.Rb(),b.Rb(),b.Rb()),2&e&&(b.Bb(1),b.kc("formGroup",t.addExpensesForm),b.Bb(19),b.kc("ngForOf",t.addExpensesForm.get("expenses").controls),b.Bb(8),b.kc("disabled",!t.addExpensesForm.controls.expenses.valid))},directives:[S.c,S.d,S.b,c.x,c.r,S.a,c.k,w.l,C.b,H.a,We.d,We.c,c.e,c.l,w.m,k.a,c.q,c.i,R.b,c.c,c.u,D.e,D.a,D.d,P.o],styles:["table[_ngcontent-%COMP%], td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{border:1px solid #3f51b5}th[_ngcontent-%COMP%]{padding-top:5px;padding-bottom:5px}table[_ngcontent-%COMP%]{border-collapse:collapse;width:100%}  .item-input .mat-select-value{min-width:100px}  .auto-width .mat-select-value,   .item-input .mat-select-value{max-width:100%;width:100%;box-sizing:border-box;padding:5px}input[_ngcontent-%COMP%]{font-family:inherit;outline:none;border:0;width:100%;box-sizing:border-box;padding:5px}.table-row-number[_ngcontent-%COMP%]{padding:5px;text-align:center}.clickable[_ngcontent-%COMP%]{cursor:pointer}.green-check[_ngcontent-%COMP%]{color:green}.search-input[_ngcontent-%COMP%]{padding:10px;border:1px solid #323232;margin:5px;width:calc(100% - 10px)}.mat-option[_ngcontent-%COMP%]{margin:1rem 0;overflow:visible;word-wrap:break-word;white-space:pre-line}.mat-option[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{display:block}"]}),e})();function nt(e,t){if(1&e&&b.Nb(0,"img",3),2&e){const e=b.ec();b.kc("src",e.imageToPreview,b.sc)}}function it(e,t){if(1&e&&(b.Sb(0,"tbody"),b.Sb(1,"tr"),b.Sb(2,"td",4),b.Ac(3),b.Rb(),b.Sb(4,"td"),b.Ac(5),b.Rb(),b.Sb(6,"td"),b.Ac(7),b.Rb(),b.Sb(8,"td"),b.Ac(9),b.Rb(),b.Sb(10,"td"),b.Ac(11),b.fc(12,"rupiah"),b.Rb(),b.Sb(13,"td"),b.Ac(14),b.fc(15,"rupiah"),b.Rb(),b.Rb(),b.Rb()),2&e){const e=t.$implicit,n=t.index;b.Bb(3),b.Cc(" ",n+1," "),b.Bb(2),b.Bc(e.item),b.Bb(2),b.Bc(e.supplier),b.Bb(2),b.Dc("",e.amount," ",e.unit,""),b.Bb(2),b.Bc(b.gc(12,7,e.pricePerUnit)),b.Bb(3),b.Bc(b.gc(15,9,e.totalPrice))}}let at=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=b.Gb({type:e,selectors:[["app-form-review"]],inputs:{addExpensesForm:"addExpensesForm",imageToPreview:"imageToPreview"},decls:21,vars:2,consts:[["fxLayout","column","fxLayoutGap","20px"],["alt","Invoice image","class","invoice-preview",3,"src",4,"ngIf"],[4,"ngFor","ngForOf"],["alt","Invoice image",1,"invoice-preview",3,"src"],[1,"table-row-number"]],template:function(e,t){1&e&&(b.Sb(0,"div",0),b.Sb(1,"h4"),b.Ac(2,"Invoice Preview"),b.Rb(),b.zc(3,nt,1,1,"img",1),b.Sb(4,"h4"),b.Ac(5,"Transactions"),b.Rb(),b.Sb(6,"table"),b.Sb(7,"thead"),b.Sb(8,"tr"),b.Nb(9,"th"),b.Sb(10,"th"),b.Ac(11,"Item"),b.Rb(),b.Sb(12,"th"),b.Ac(13,"Supplier"),b.Rb(),b.Sb(14,"th"),b.Ac(15,"Amount"),b.Rb(),b.Sb(16,"th"),b.Ac(17,"Price/Unit"),b.Rb(),b.Sb(18,"th"),b.Ac(19,"Total price"),b.Rb(),b.Rb(),b.Rb(),b.zc(20,it,16,11,"tbody",2),b.Rb(),b.Rb()),2&e&&(b.Bb(3),b.kc("ngIf",t.imageToPreview),b.Bb(17),b.kc("ngForOf",t.addExpensesForm.controls.expenses.value))},directives:[S.c,S.d,w.m,w.l],pipes:[J],styles:["table[_ngcontent-%COMP%], td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{border:1px solid #3f51b5}th[_ngcontent-%COMP%]{padding-top:5px;padding-bottom:5px}table[_ngcontent-%COMP%]{border-collapse:collapse;width:100%}.invoice-preview[_ngcontent-%COMP%]{align-self:center;width:500px;height:auto}.table-row-number[_ngcontent-%COMP%]{padding:5px;text-align:center}"]}),e})();var st=n("Xa2L");let ot=(()=>{class e{transform(e,...t){return e>=1e6?(e/1e6).toFixed(1)+" MB":e>=1e3?(e/1e3).toFixed(1)+" KB":e+" B"}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=b.Lb({name:"fileSize",type:e,pure:!0}),e})();function rt(e,t){1&e&&b.Nb(0,"mat-spinner",19)}function ct(e,t){1&e&&(b.Sb(0,"mat-icon",20),b.Ac(1,"check"),b.Rb())}function lt(e,t){if(1&e&&(b.Sb(0,"div"),b.Ac(1),b.fc(2,"fileSize"),b.fc(3,"fileSize"),b.Rb()),2&e){const e=b.ec(2);b.Bb(1),b.Dc(" ",b.gc(2,2,e.uploadProgress)," /",b.gc(3,4,e.totalUploadSize),"")}}function bt(e,t){if(1&e&&(b.Sb(0,"div",15),b.zc(1,rt,1,0,"mat-spinner",16),b.zc(2,ct,2,0,"mat-icon",17),b.Sb(3,"div"),b.Ac(4,"Uploading invoice"),b.Rb(),b.zc(5,lt,4,6,"div",18),b.Rb()),2&e){const e=b.ec();b.Bb(1),b.kc("ngIf",e.uploadProgress<e.totalUploadSize),b.Bb(1),b.kc("ngIf",e.uploadProgress===e.totalUploadSize),b.Bb(3),b.kc("ngIf",e.uploadProgress!==e.totalUploadSize)}}function dt(e,t){1&e&&b.Nb(0,"mat-spinner",19)}function pt(e,t){1&e&&(b.Sb(0,"mat-icon",20),b.Ac(1,"check"),b.Rb())}function ut(e,t){if(1&e&&(b.Sb(0,"div"),b.Ac(1),b.Rb()),2&e){const e=b.ec(2);b.Bb(1),b.Dc(" ",e.submittedExpenses,"/",e.totalExpenses,"")}}function mt(e,t){if(1&e&&(b.Sb(0,"div",15),b.zc(1,dt,1,0,"mat-spinner",16),b.zc(2,pt,2,0,"mat-icon",17),b.Sb(3,"div"),b.Ac(4,"Submitting expenses"),b.Rb(),b.zc(5,ut,2,2,"div",18),b.Rb()),2&e){const e=b.ec();b.Bb(1),b.kc("ngIf",e.submittedExpenses!==e.totalExpenses),b.Bb(1),b.kc("ngIf",e.submittedExpenses===e.totalExpenses),b.Bb(3),b.kc("ngIf",e.submittedExpenses!==e.totalExpenses)}}const ht=[{path:"add-new-expense",component:(()=>{class e{constructor(e,t,n,i,a,s){this.authService=e,this.imagesService=t,this.expensesService=n,this.snackBar=i,this.router=a,this.location=s,this.disableButton=!1,this.submittedExpenses=0,this.addExpensesForm=new c.j({invoice:new c.g(null,[c.w.required,Object(q.b)(["png","jpg","jpeg"])]),expenses:new c.d([this.createExpense()],[c.w.required])}),this.takeFile=e=>{this.addExpensesForm.patchValue({invoice:e});let t=new FileReader;t.readAsDataURL(this.addExpensesForm.controls.invoice.value),t.onload=()=>this.imageToUpload=t.result},this.submit=()=>{this.disableButton=!0,this.totalExpenses=this.addExpensesForm.value.expenses.length,this.imagesService.uploadInvoice(this.addExpensesForm.value.invoice).pipe(Object(Te.a)(e=>e.type===p.d.Response?Object(ze.a)(e.body):(e.type===p.d.UploadProgress&&(this.uploadProgress=e.loaded,this.totalUploadSize=e.total),Object(ze.a)(null))),Object($e.a)(e=>null!==e),Object(Te.a)(e=>e.success?Object(ze.a)(e.invoice):(this.snackBar.open(e.msg,"",{panelClass:["error-snackbar"]}),this.disableButton=!1,Object(ze.a)(null))),Object($e.a)(e=>null!=e)).subscribe(e=>{this.addExpensesForm.value.expenses.map(t=>this.expensesService.addExpense({item:t.item,supplier:t.supplier,amount:t.amount,unit:t.unit,pricePerUnit:t.pricePerUnit,totalPrice:t.totalPrice,dateOfExpense:new Date,submittedBy:this.user.name,invoiceId:e._id}).pipe(Object(Te.a)(e=>e.success?Object(ze.a)(e.expense):(this.snackBar.open(e.msg,"",{panelClass:["error-snackbar"]}),this.disableButton=!1,Object(ze.a)(null))),Object($e.a)(e=>null!==e)).subscribe(()=>{this.submittedExpenses++,this.submittedExpenses===this.totalExpenses&&(this.snackBar.open("Expenses submitted successfully","",{panelClass:["success-snackbar"]}),this.router.navigate(["expensesManager"]))}))})},this.goBack=()=>this.location.back()}createExpense(){return new c.j({item:new c.g(void 0,c.w.required),supplier:new c.g(void 0,c.w.required),amount:new c.g(void 0,c.w.required),unit:new c.g(l.Kg),pricePerUnit:new c.g(void 0,c.w.required),totalPrice:new c.g(void 0,c.w.required)})}addRow(){this.addExpensesForm.get("expenses").push(this.createExpense())}deleteRow(e){this.addExpensesForm.get("expenses").removeAt(e)}ngOnInit(){this.userSubscription=this.authService.userSubject.subscribe(e=>this.user=e)}ngOnDestroy(){this.userSubscription.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(b.Mb(d.a),b.Mb(q.a),b.Mb(m),b.Mb(h.b),b.Mb(i.b),b.Mb(w.i))},e.\u0275cmp=b.Gb({type:e,selectors:[["app-add-expense-stepper"]],decls:23,vars:10,consts:[["fxLayout","row","fxLayoutGap","10px","fxLayoutAlign","start center"],["mat-stroked-button","","color","accent",3,"click"],[3,"formGroup"],["linear",""],["label","Upload an invoice",3,"stepControl"],[3,"uploadInvoiceForm","fileEmitter"],["label","Add expenses",3,"stepControl"],[3,"addExpensesForm","addRow","deleteRow"],["label","Review and confirm"],[3,"imageToPreview","addExpensesForm"],["fxLayout","column","fxLayoutAlign","start center","fxLayoutGap","20px"],["fxLayout","row","fxFlex","100%","fxLayoutAlign","center","fxLayoutGap","10px",1,"pt-25px"],["mat-stroked-button","","color","accent","matStepperPrevious",""],["mat-raised-button","","color","primary","type","submit",3,"disabled","click"],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","10px",4,"ngIf"],["fxLayout","row","fxLayoutAlign","center center","fxLayoutGap","10px"],["diameter","14",4,"ngIf"],["class","green-check",4,"ngIf"],[4,"ngIf"],["diameter","14"],[1,"green-check"]],template:function(e,t){1&e&&(b.Sb(0,"div",0),b.Sb(1,"button",1),b.ac("click",(function(){return t.goBack()})),b.Sb(2,"mat-icon"),b.Ac(3,"keyboard_arrow_left"),b.Rb(),b.Ac(4," Back "),b.Rb(),b.Sb(5,"h3"),b.Ac(6,"Add new expenses"),b.Rb(),b.Rb(),b.Sb(7,"form",2),b.Sb(8,"mat-vertical-stepper",3),b.Sb(9,"mat-step",4),b.Sb(10,"app-upload-invoice",5),b.ac("fileEmitter",(function(e){return t.takeFile(e)})),b.Rb(),b.Rb(),b.Sb(11,"mat-step",6),b.Sb(12,"app-add-expenses",7),b.ac("addRow",(function(){return t.addRow()}))("deleteRow",(function(e){return t.deleteRow(e)})),b.Rb(),b.Rb(),b.Sb(13,"mat-step",8),b.Nb(14,"app-form-review",9),b.Sb(15,"div",10),b.Sb(16,"div",11),b.Sb(17,"button",12),b.Ac(18,"Previous"),b.Rb(),b.Sb(19,"button",13),b.ac("click",(function(){return t.submit()})),b.Ac(20,"Submit "),b.Rb(),b.Rb(),b.zc(21,bt,6,3,"div",14),b.zc(22,mt,6,3,"div",14),b.Rb(),b.Rb(),b.Rb(),b.Rb()),2&e&&(b.Bb(7),b.kc("formGroup",t.addExpensesForm),b.Bb(2),b.kc("stepControl",t.addExpensesForm.controls.invoice),b.Bb(1),b.kc("uploadInvoiceForm",t.addExpensesForm),b.Bb(1),b.kc("stepControl",t.addExpensesForm.controls.expenses),b.Bb(1),b.kc("addExpensesForm",t.addExpensesForm),b.Bb(2),b.kc("imageToPreview",t.imageToUpload)("addExpensesForm",t.addExpensesForm),b.Bb(5),b.kc("disabled",t.disableButton),b.Bb(2),b.kc("ngIf",t.uploadProgress>0),b.Bb(1),b.kc("ngIf",t.uploadProgress>0&&t.uploadProgress===t.totalUploadSize))},directives:[S.c,S.d,S.b,C.b,H.a,c.x,c.r,c.k,We.e,We.a,Ve,tt,at,S.a,We.d,w.m,st.b],pipes:[ot],styles:[".pt-25px[_ngcontent-%COMP%]{padding-top:25px}.green-check[_ngcontent-%COMP%]{color:green}"]}),e})()},{path:"",component:ke,children:[{path:"list-of-expenses",component:Se},{path:"charts",component:qe},{path:"",pathMatch:"full",redirectTo:"list-of-expenses"},{path:"**",component:a.a}]}];let gt=(()=>{class e{}return e.\u0275mod=b.Kb({type:e}),e.\u0275inj=b.Jb({factory:function(t){return new(t||e)},imports:[[i.e.forChild(ht)],i.e]}),e})();var ft=n("PCNd");let xt=(()=>{class e{static forRoot(){return{ngModule:e}}}return e.\u0275mod=b.Kb({type:e}),e.\u0275inj=b.Jb({factory:function(t){return new(t||e)},imports:[[ft.a.forRoot(),gt]]}),e})()}}]);